<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pichler &amp; Hartig, 2022">

<title>Supporting information S1 for Pichler &amp; Hartig – Machine Learning and Deep Learning – A review for Ecologists</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="Supporting_Information_files/libs/clipboard/clipboard.min.js"></script>
<script src="Supporting_Information_files/libs/quarto-html/quarto.js"></script>
<script src="Supporting_Information_files/libs/quarto-html/popper.min.js"></script>
<script src="Supporting_Information_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Supporting_Information_files/libs/quarto-html/anchor.min.js"></script>
<link href="Supporting_Information_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Supporting_Information_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Supporting_Information_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Supporting_Information_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Supporting_Information_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Supporting information S1 for Pichler &amp; Hartig – Machine Learning and Deep Learning – A review for Ecologists</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Pichler &amp; Hartig, 2022 </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<p><strong>Summary:</strong> This document provides supporting information on Pichler &amp; Hartig – Machine Learning and Deep Learning – A review for ecologists. The first section describes the methods for the trend analysis and the word clouds, the second section demnstrates the application of common supervised Machine learning and Deep learning algorithms in the R programming languages based on code examples.</p>
<section id="trend-analysis" class="level2">
<h2 class="anchored" data-anchor-id="trend-analysis">Trend analysis</h2>
<p>For the global trend analysis in Figure 1, we used the R package ‘europepmc’ (v0.4.1, <span class="citation" data-cites="jahn_europepmc_2021">Jahn (<a href="#ref-jahn_europepmc_2021" role="doc-biblioref">2021</a>)</span>) to search from 1920 to 2021 the PubMed and Medline NLM databases. We used the following queries ‘deep learning’, (‘machine learning’ OR ‘machine-learning’), and (‘p value’ OR ‘p-value’ OR ‘statistically significant) as representatives for Deep Learning, Machine Learning, and classical statistical approaches. The number of hits were normalized by total hits in each year. For the stream charts in Figure 2, we used the search queries Table S1 and added them to the query’ AND (“ecology” OR “ecolog*” OR “evolution”) to restrict the queries to hits from the ecology and evolution field.</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-1_58319f3d3fc7ab50f48658492337d935">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 75%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Queries</th>
<th style="text-align: left;">ML and DL algorithm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(“artificial neural network” OR “deep neural network” OR</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">“multi-layer perceptron” OR “fully connected neural network”)</td>
<td style="text-align: left;">Deep neural network (ANN)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(“convolutional neural network” OR “object detection”)</td>
<td style="text-align: left;">Convolutional neural network (CNN)</td>
</tr>
<tr class="even">
<td style="text-align: left;">(“recurrent neural network”)</td>
<td style="text-align: left;">Recurrent neural network (RNN)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(“graph neural network” OR “graph convolutional”)</td>
<td style="text-align: left;">Graph neural network (GNN)</td>
</tr>
<tr class="even">
<td style="text-align: left;">(“random forest”)</td>
<td style="text-align: left;">Random Forest (RF)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(“boosted regression tree” OR “boosted reg” OR</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">“gradient boosting” OR “adaboost”)</td>
<td style="text-align: left;">Boosted Regression Trees (BRT)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(“k-nearest-neighbor”)</td>
<td style="text-align: left;">k-nearest neighbor (kNN)</td>
</tr>
<tr class="even">
<td style="text-align: left;">(“ridge regression” OR “lasso regression” OR</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">“elastic-net” OR “elastic net”)</td>
<td style="text-align: left;">Ridge, lasso, or elastic-net regression</td>
</tr>
<tr class="even">
<td style="text-align: left;">(“support vector machine” OR “support vector”)</td>
<td style="text-align: left;">Support vector machine (SVM)</td>
</tr>
</tbody>
</table>
<p>Search queries and their corresponding ML and DL algorithm.</p>
</div>
</div>
<p>For the word clouds in Table 1, we used again the ‘europepmc’ R package to search abstracts and titles within the ML and DL algorithm specific queries (Table 1) for the following ecological keywords: species distribution, species interaction, mortality, remote sensing, invasive, decision making, ecosystem, species identification, species detection, extinction, functional trait, ecological network, biodiversity, and camera trap.</p>
<p>We used the R packages ‘tm’ (<span class="citation" data-cites="feinerer2008">Feinerer, Hornik, and Meyer (<a href="#ref-feinerer2008" role="doc-biblioref">2008</a>)</span>), ‘wordcloud’ (<span class="citation" data-cites="wordcloud2018">Fellows (<a href="#ref-wordcloud2018" role="doc-biblioref">2018</a>)</span>) ,and ‘wordcloud2’ (<span class="citation" data-cites="wordcloud_2_2018">Lang and Chien (<a href="#ref-wordcloud_2_2018" role="doc-biblioref">2018</a>)</span>) to analyze and create the final word cloud plots.</p>
</section>
<section id="algorithms" class="level2">
<h2 class="anchored" data-anchor-id="algorithms">Algorithms</h2>
<p>The goal of this chapter is to provide short code examples for all common supervised ML algorithms. All examples are shown in the R programming language and are demonstrated at the example of the iris dataset (4 continuous and 1 nominal variables). We demonstrate a) how to apply the algorithms on classification tasks (response = nominal, three species) and how to generate class specific (quasi) probability predictions and b) how to apply the algorithms to regression tasks (response = continuous) and make continuous predictions.</p>
</section>
<section id="ridge-lasso-and-elastic-net-regression" class="level1">
<h1>Ridge, LASSO, and elastic-net regression</h1>
<p>We can use the ‘glmnet’ R package (<span class="citation" data-cites="glmnet">Simon et al. (<a href="#ref-glmnet" role="doc-biblioref">2011</a>)</span>) for Ridge, LASSO, or elastic-net regularization. The ‘glmnet’ package supports different response families including ‘gaussian’, ‘binomial’ and ‘Poisson’. The strength of the regularization is set by the ‘lambda’ argument (<span class="math inline">\(\lambda\)</span>) and the weighting between Ridge and LASSO regularization by the ‘alpha’ parameter (<span class="math inline">\(\alpha\)</span>):</p>
<p><span class="math display">\[
\lambda*[(1 - \alpha)\|\beta\|_1 + \alpha\|\beta||^2]
\]</span> Setting alpha = 0 turns off the LASSO and alpha = 1 the Ridge. Alphas between (0,1) will use both regularization types, turning the model into an elastic-net regularization.</p>
<p>When using regularization, it is important to scale all features otherwise effects for features that are on a larger scale are stronger regularized.</p>
<p>In python, the ‘scikit-learn’ package provides an interface for many different ML algorithms, including elastic-net regression models (<span class="citation" data-cites="scikit-learn">(<a href="#ref-scikit-learn" role="doc-biblioref"><strong>scikit-learn?</strong></a>)</span>).</p>
<p>The ‘MLJ’ package provides a generic interface for different ML algorithms (<span class="citation" data-cites="anthony_blaom_2019_3541506">(<a href="#ref-anthony_blaom_2019_3541506" role="doc-biblioref"><strong>anthony_blaom_2019_3541506?</strong></a>)</span>). Elastic-net regression models can be accessed via the ‘MLJLinearModels’ package within MLJ.</p>
<section id="classification" class="level2">
<h2 class="anchored" data-anchor-id="classification">Classification</h2>
<p>Build models (for regularization it is important to scale the features):</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-3_6d938f3a8274f65ba3bf1d01058cd4dd">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">scale</span>(iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> iris<span class="sc">$</span>Species</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>ridge <span class="ot">=</span> <span class="fu">glmnet</span>(X, Y, <span class="at">family =</span> <span class="st">"multinomial"</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="fl">0.01</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># LASSO:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">=</span> <span class="fu">glmnet</span>(X, Y, <span class="at">family =</span> <span class="st">"multinomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> <span class="fl">0.01</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Elastic-net:</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>elastic <span class="ot">=</span> <span class="fu">glmnet</span>(X, Y, <span class="at">family =</span> <span class="st">"multinomial"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">lambda =</span> <span class="fl">0.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make predictions (class probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-4_df954a8b02151282ac130d3476ef4352">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(lasso, <span class="at">newx =</span> X, <span class="at">type =</span> <span class="st">"response"</span>)[,,<span class="dv">1</span>], <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        setosa versicolor    virginica
[1,] 0.9858987 0.01410131 3.438452e-09
[2,] 0.9668897 0.03311031 1.397684e-08
[3,] 0.9815369 0.01846312 5.279315e-09</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>In the sklearn implementation the regularization strength parameter ‘C’ corresponds to the lambda parameter from glmnet:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-6_a58f847291b8e9ee71482f4ccf7eb80a">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(iris.data)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris.target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Models:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-7_de73e6f6ab004fcc11ecceb2b78502ba">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ridge <span class="op">=</span> LogisticRegression(multi_class<span class="op">=</span><span class="st">'multinomial'</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                           penalty <span class="op">=</span> <span class="st">"l2"</span>, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                           C <span class="op">=</span> <span class="fl">0.01</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                           solver<span class="op">=</span><span class="st">"saga"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>ridge.fit(X, Y)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># LASSO:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(C=0.01, multi_class='multinomial', solver='saga')</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(C=0.01, multi_class='multinomial', solver='saga')</pre></div></div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> LogisticRegression(multi_class<span class="op">=</span><span class="st">'multinomial'</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                           penalty <span class="op">=</span> <span class="st">"l1"</span>, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                           C <span class="op">=</span> <span class="fl">0.01</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                           solver<span class="op">=</span><span class="st">"saga"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>lasso.fit(X, Y)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Elastic-net:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(C=0.01, multi_class='multinomial', penalty='l1',
                   solver='saga')</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(C=0.01, multi_class='multinomial', penalty='l1',
                   solver='saga')</pre></div></div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>elastic <span class="op">=</span> LogisticRegression(multi_class<span class="op">=</span><span class="st">'multinomial'</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                             penalty <span class="op">=</span> <span class="st">"elasticnet"</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                             C <span class="op">=</span> <span class="fl">0.01</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                             l1_ratio<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                             solver<span class="op">=</span><span class="st">"saga"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>elastic.fit(X, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(C=0.01, l1_ratio=0.5, multi_class='multinomial',
                   penalty='elasticnet', solver='saga')</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(C=0.01, l1_ratio=0.5, multi_class='multinomial',
                   penalty='elasticnet', solver='saga')</pre></div></div></div></div></div>
</div>
</div>
<p>Predictions (probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-8_681fc116c63695587620993bf78612ca">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lasso.predict_proba(X)[<span class="dv">0</span>:<span class="dv">5</span>,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.34310365, 0.3363204 , 0.32057595],
       [0.34310365, 0.3363204 , 0.32057595],
       [0.34310365, 0.3363204 , 0.32057595],
       [0.34310365, 0.3363204 , 0.32057595],
       [0.34310365, 0.3363204 , 0.32057595]])</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-9_d6e3f142622d73278d7cbe2ddacbebb0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJ;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJLinearModels;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@load</span> MultinomialClassifier pkg<span class="op">=</span>MLJLinearModels;</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-10_646d53f714968a2c974977352d6fe421">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>]);</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">5</span>];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Models:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-11_376c6058258f82f951d28cf8f278d227">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>ridge <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">MultinomialClassifier</span>(lambda <span class="op">=</span> <span class="fl">0.01</span>, penalty <span class="op">=</span> <span class="st">"l2"</span>), X, Y));</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">MultinomialClassifier</span>(lambda <span class="op">=</span> <span class="fl">0.01</span>, penalty <span class="op">=</span> <span class="st">"l1"</span>), X, Y));</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Elastic-net</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>elastic <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">MultinomialClassifier</span>(lambda <span class="op">=</span> <span class="fl">0.01</span>, gamma <span class="op">=</span> <span class="fl">0.01</span>, penalty <span class="op">=</span> <span class="st">"en"</span>), X, Y));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-12_3fb74d49b273e4542e44445048331cac">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>MLJ.<span class="fu">predict</span>(lasso, X)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element CategoricalDistributions.UnivariateFiniteVector{Multiclass{3}, String, UInt8, Float64}:
 UnivariateFinite{Multiclass{3}}(setosa=&gt;0.992, versicolor=&gt;0.00829, virginica=&gt;2.2e-9)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;0.969, versicolor=&gt;0.031, virginica=&gt;1.4e-8)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;0.985, versicolor=&gt;0.0149, virginica=&gt;4.6e-9)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;0.971, versicolor=&gt;0.0293, virginica=&gt;1.41e-8)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;0.994, versicolor=&gt;0.00635, virginica=&gt;1.51e-9)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="regression" class="level2">
<h2 class="anchored" data-anchor-id="regression">Regression</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-13_1edd67b07301c384ed5a94f83e2601a8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">scale</span>(iris[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> iris[,<span class="dv">1</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge:</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>ridge <span class="ot">=</span> <span class="fu">glmnet</span>(X, Y, <span class="at">family =</span> <span class="fu">gaussian</span>(), <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="fl">0.01</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># LASSO:</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">=</span> <span class="fu">glmnet</span>(X, Y, <span class="at">family =</span> <span class="fu">gaussian</span>(), <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> <span class="fl">0.01</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Elastic-net:</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>elastic <span class="ot">=</span> <span class="fu">glmnet</span>(X, Y, <span class="at">family =</span> <span class="fu">gaussian</span>(), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">lambda =</span> <span class="fl">0.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make predictions (class probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-14_96364a1dbaebda2e52478384f46729c6">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(lasso, <span class="at">newx =</span> X), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           s0
[1,] 5.006484
[2,] 4.720600
[3,] 4.781548</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>For regressions we can use the ElasticNet model class, here, however, lambda corresponds to alpha and l1_ratio to the alpha parameter.</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-15_ee29954ee20cc38c8dceccdb8c231397">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> ElasticNet</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> iris.data</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(data[:,<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> data[:,<span class="dv">0</span>]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge:</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>ridge <span class="op">=</span> ElasticNet(alpha <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                   l1_ratio <span class="op">=</span> <span class="fl">0.011</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>ridge.fit(X, Y)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># LASSO:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ElasticNet(alpha=0.01, l1_ratio=0.011)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked=""><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">ElasticNet</label><div class="sk-toggleable__content"><pre>ElasticNet(alpha=0.01, l1_ratio=0.011)</pre></div></div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> ElasticNet(alpha <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                   l1_ratio <span class="op">=</span> <span class="fl">1.0</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>lasso.fit(X, Y)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Elastic-net:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-5 {color: black;background-color: white;}#sk-container-id-5 pre{padding: 0;}#sk-container-id-5 div.sk-toggleable {background-color: white;}#sk-container-id-5 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-5 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-5 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-5 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-5 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-5 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-5 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-5 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-5 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-5 div.sk-item {position: relative;z-index: 1;}#sk-container-id-5 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-5 div.sk-item::before, #sk-container-id-5 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-5 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-5 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-5 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-5 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-5 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-5 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-5 div.sk-label-container {text-align: center;}#sk-container-id-5 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-5 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ElasticNet(alpha=0.01, l1_ratio=1.0)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" checked=""><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">ElasticNet</label><div class="sk-toggleable__content"><pre>ElasticNet(alpha=0.01, l1_ratio=1.0)</pre></div></div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>elastic <span class="op">=</span> ElasticNet(alpha <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                     l1_ratio <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>elastic.fit(X, Y)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-6 {color: black;background-color: white;}#sk-container-id-6 pre{padding: 0;}#sk-container-id-6 div.sk-toggleable {background-color: white;}#sk-container-id-6 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-6 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-6 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-6 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-6 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-6 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-6 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-6 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-6 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-6 div.sk-item {position: relative;z-index: 1;}#sk-container-id-6 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-6 div.sk-item::before, #sk-container-id-6 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-6 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-6 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-6 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-6 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-6 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-6 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-6 div.sk-label-container {text-align: center;}#sk-container-id-6 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-6 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ElasticNet(alpha=0.01)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" checked=""><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">ElasticNet</label><div class="sk-toggleable__content"><pre>ElasticNet(alpha=0.01)</pre></div></div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>lasso.predict(X)[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([5.0064384 , 4.72032938, 4.78125162, 4.83107256, 5.06366021,
       5.36149937, 4.93202142, 5.00273797, 4.66310758, 4.84826774])</code></pre>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-16_20a95ac5cd54c6104ec75e704e6c6f25">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJ;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJLinearModels;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@load</span> LassoRegressor pkg<span class="op">=</span>MLJLinearModels;</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="pp">@load</span> RidgeRegressor pkg<span class="op">=</span>MLJLinearModels;</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="pp">@load</span> ElasticNetRegressor pkg<span class="op">=</span>MLJLinearModels;</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-17_b836c0831406b79f41fb950757450a86">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>]);</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">1</span>];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Models:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-18_245b735996bef8e15d87e35a5474d991">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ridge <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">RidgeRegressor</span>(lambda <span class="op">=</span> <span class="fl">0.01</span>), X, Y));</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">LassoRegressor</span>(lambda <span class="op">=</span> <span class="fl">0.01</span>), X, Y));</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Elastic-net</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>elastic <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">ElasticNetRegressor</span>(lambda <span class="op">=</span> <span class="fl">0.01</span>, gamma <span class="op">=</span> <span class="fl">0.01</span>), X, Y));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Predictions (probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-19_bba5070a37ea497a8b71b6004185e2c1">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>MLJ.<span class="fu">predict</span>(lasso, X)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element Vector{Float64}:
 5.007709152258313
 4.711530001523257
 4.770100849643125
 4.830666643844422
 5.0669449824053245</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="support-vector-machines" class="level1">
<h1>Support Vector Machines</h1>
<p>The support vector machine (SVM) algorithm estimates hyper-planes to separate our response species. In the following we use the ‘e1071’ package which supports a variety of different SVM algorithms (<span class="citation" data-cites="e1071">Meyer et al. (<a href="#ref-e1071" role="doc-biblioref">2022</a>)</span>) (Python: ‘scikit-learn’ (<span class="citation" data-cites="scikit-learn">(<a href="#ref-scikit-learn" role="doc-biblioref"><strong>scikit-learn?</strong></a>)</span>), Julia: ‘MLJ’ (<span class="citation" data-cites="anthony_blaom_2019_3541506">(<a href="#ref-anthony_blaom_2019_3541506" role="doc-biblioref"><strong>anthony_blaom_2019_3541506?</strong></a>)</span>)).</p>
<section id="classification-1" class="level2">
<h2 class="anchored" data-anchor-id="classification-1">Classification</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-21_905666221b09d5a986f8e5769fd2a6cf">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">scale</span>(iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> iris<span class="sc">$</span>Species</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>sv <span class="ot">=</span> <span class="fu">svm</span>(X, Y, <span class="at">probability =</span> <span class="cn">TRUE</span>) </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svm.default(x = X, y = Y, probability = TRUE)


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  radial 
       cost:  1 

Number of Support Vectors:  51

 ( 8 22 21 )


Number of Classes:  3 

Levels: 
 setosa versicolor virginica</code></pre>
</div>
</div>
<p>Make predictions (class probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-22_568847e491c580d4a9671c8eac35a546">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">attr</span>(<span class="fu">predict</span>(sv, <span class="at">newdata =</span> X, <span class="at">probability =</span> <span class="cn">TRUE</span>), <span class="st">"probabilities"</span>), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     setosa versicolor   virginica
1 0.9801643 0.01032925 0.009506421
2 0.9731464 0.01657838 0.010275225
3 0.9788211 0.01091394 0.010264973</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-23_4111578ec385f2137c7c4a1861848e93">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> svm</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(iris.data)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris.target</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> svm.SVC(probability<span class="op">=</span><span class="va">True</span>).fit(X, Y)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions (class probabilities):</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>model.predict_proba(X)[<span class="dv">0</span>:<span class="dv">10</span>,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.97984486, 0.01137049, 0.00878465],
       [0.97258801, 0.01798096, 0.00943103],
       [0.97859532, 0.01193082, 0.00947386],
       [0.97456821, 0.01526382, 0.01016797],
       [0.97897998, 0.01172791, 0.0092921 ],
       [0.97352296, 0.01682697, 0.00965007],
       [0.97516576, 0.01357127, 0.01126297],
       [0.97974736, 0.01147932, 0.00877332],
       [0.96580558, 0.02234967, 0.01184476],
       [0.97637599, 0.01405457, 0.00956944]])</code></pre>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-24_7dae9447c6d072ce886715fa718aa935">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJ;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>SVM_classifier <span class="op">=</span> <span class="pp">@load</span> NuSVC pkg<span class="op">=</span>LIBSVM;</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-25_98dec218f16b8023fdf0a7ba7b58d6a7">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>]);</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">5</span>];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Models:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-26_85a0ff5dad28363d8a87e056a5ced456">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">SVM_classifier</span>(), X, Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>trained Machine; caches model-specific representations of data
  model: NuSVC(kernel = RadialBasis, …)
  args: 
    1:  Source @779 ⏎ Table{AbstractVector{Continuous}}
    2:  Source @621 ⏎ AbstractVector{Multiclass{3}}</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-27_431dec58ecb16204ebfeca640775b0fe">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>MLJ.<span class="fu">predict</span>(model, X)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element CategoricalArrays.CategoricalArray{String,1,UInt8}:
 "setosa"
 "setosa"
 "setosa"
 "setosa"
 "setosa"</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="regression-1" class="level2">
<h2 class="anchored" data-anchor-id="regression-1">Regression</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-28_235e26457cfc173328a652da70b7c8db">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">scale</span>(iris[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> iris[,<span class="dv">1</span>]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>sv <span class="ot">=</span> <span class="fu">svm</span>(X, Y) </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svm.default(x = X, y = Y)


Parameters:
   SVM-Type:  eps-regression 
 SVM-Kernel:  radial 
       cost:  1 
      gamma:  0.3333333 
    epsilon:  0.1 


Number of Support Vectors:  124</code></pre>
</div>
</div>
<p>Make predictions (class probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-29_6f06dde58dbd0ebd08157215cc143106">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(sv, <span class="at">newdata =</span> X), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3 
5.042085 4.711768 4.836291 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-30_1ff015cc95e3445b3083b74c179a944a">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> svm</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> iris.data</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(data[:,<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> data[:,<span class="dv">0</span>]</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> svm.SVR().fit(X, Y)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions:</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>model.predict(X)[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([5.03583855, 4.69496586, 4.81438855, 4.77951854, 5.10018373,
       5.29981857, 4.97308737, 4.98199033, 4.63701656, 4.78431078])</code></pre>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-31_ae73e5202977bb383b7702428f2cedcc">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJ;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>SVM_regressor <span class="op">=</span>  <span class="pp">@load</span> NuSVR pkg<span class="op">=</span>LIBSVM;</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-32_ca1610d81bde7dce62a9f1eca19fa86f">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>]);</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">1</span>];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Model:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-33_ee8e84d938ba65890f8447f7936009b0">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">SVM_regressor</span>(), X, Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>trained Machine; caches model-specific representations of data
  model: NuSVR(kernel = RadialBasis, …)
  args: 
    1:  Source @736 ⏎ Table{AbstractVector{Continuous}}
    2:  Source @505 ⏎ AbstractVector{Continuous}</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-34_315e3dab35dcd24d1c47e265e907e8b8">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>MLJ.<span class="fu">predict</span>(model, X)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element Vector{Float64}:
 5.058471741834634
 4.6717512552719604
 4.799641470830148
 4.75734816087994
 5.133728219775252</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="k-nearest-neighbor" class="level1">
<h1>k-nearest-neighbor</h1>
<p>The k-nearest-neighbor algorithm doesn’t really learn from the data, predictions for new observations are made based on the class affiliation (or response value) of the nearest neighbors, e.g.&nbsp;by majority voting or averaging. The nearest neighbors are found by calculating the distance of the new observation to all observations in the train dataset.</p>
<p>In the following we use the ‘kknn’ package (<span class="citation" data-cites="kknn">Schliep and Hechenbichler (<a href="#ref-kknn" role="doc-biblioref">2016</a>)</span>) (Python: ‘scikit-learn’ (<span class="citation" data-cites="scikit-learn">(<a href="#ref-scikit-learn" role="doc-biblioref"><strong>scikit-learn?</strong></a>)</span>), Julia: ‘MLJ’ (<span class="citation" data-cites="anthony_blaom_2019_3541506">(<a href="#ref-anthony_blaom_2019_3541506" role="doc-biblioref"><strong>anthony_blaom_2019_3541506?</strong></a>)</span>)). Different to other ML packages we can provide here already the test dataset in the fit function.</p>
<section id="classification-2" class="level2">
<h2 class="anchored" data-anchor-id="classification-2">Classification</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-36_f4748287127ae2e00f24725982b5d6c0">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kknn)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">scale</span>(iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> iris[,<span class="dv">5</span>,drop<span class="ot">=</span><span class="cn">FALSE</span>]</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">cbind</span>(Y, X)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>knn <span class="ot">=</span> <span class="fu">kknn</span>(Species<span class="sc">~</span>., <span class="at">train =</span> data, <span class="at">test =</span> data) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make predictions (class probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-37_f921e66846d93017453bc8fe0ed37ef8">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(knn<span class="sc">$</span>prob, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     setosa versicolor virginica
[1,]      1          0         0
[2,]      1          0         0
[3,]      1          0         0</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-38_f5cbc563f5ae6ce16448cabb3096f16c">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(iris.data)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris.target</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> KNeighborsClassifier().fit(X, Y)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions:</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>model.predict_proba(X)[<span class="dv">0</span>:<span class="dv">10</span>,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.]])</code></pre>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-39_1e962fca5f68cb637fc629a46d9e25b2">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJ;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>kNN_classifier <span class="op">=</span> <span class="pp">@load</span> KNNClassifier pkg<span class="op">=</span>NearestNeighborModels;</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase;</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-40_eac84d9cb60d8ab78966c43facc192e0">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>]);</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">5</span>];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Models:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-41_3a37ef250798212e3c34809e6ae55637">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">kNN_classifier</span>(), X, Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>trained Machine; caches model-specific representations of data
  model: KNNClassifier(K = 5, …)
  args: 
    1:  Source @125 ⏎ Table{AbstractVector{Continuous}}
    2:  Source @916 ⏎ AbstractVector{Multiclass{3}}</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-42_3f687596bcfa0f026563fb201c2579db">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>MLJ.<span class="fu">predict</span>(model, X)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element CategoricalDistributions.UnivariateFiniteVector{Multiclass{3}, String, UInt8, Float64}:
 UnivariateFinite{Multiclass{3}}(setosa=&gt;1.0, versicolor=&gt;0.0, virginica=&gt;0.0)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;1.0, versicolor=&gt;0.0, virginica=&gt;0.0)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;1.0, versicolor=&gt;0.0, virginica=&gt;0.0)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;1.0, versicolor=&gt;0.0, virginica=&gt;0.0)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;1.0, versicolor=&gt;0.0, virginica=&gt;0.0)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="regression-2" class="level2">
<h2 class="anchored" data-anchor-id="regression-2">Regression</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-43_48f956c6812bd5c97928ca062bd31dff">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">scale</span>(iris[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">cbind</span>(iris[,<span class="dv">1</span>,<span class="at">drop=</span><span class="cn">FALSE</span>], X)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>knn <span class="ot">=</span> <span class="fu">kknn</span>(Sepal.Length<span class="sc">~</span>., <span class="at">train =</span> data, <span class="at">test =</span> data) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make predictions (class probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-44_fddcc1d2ddb143793695732d287fa91b">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(knn), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.188492 4.739986 4.685332</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-45_406865258c7953979ee869b09e00174a">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> iris.data</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(data[:,<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> data[:,<span class="dv">0</span>]</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> KNeighborsRegressor().fit(X, Y)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions:</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>model.predict(X)[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([5.18, 4.78, 4.68, 4.76, 4.98, 5.34, 5.06, 5.1 , 4.7 , 4.8 ])</code></pre>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-46_2ea513efc65842e7dacafb5b04ee501e">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJ;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>kNN_regressor <span class="op">=</span>  <span class="pp">@load</span> KNNRegressor pkg<span class="op">=</span>NearestNeighborModels;</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-47_b4a2ee74fc5125911a300c706f16eef6">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>]);</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">1</span>];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Model:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-48_301eab6f6061eb6799eeb7a67b603dfe">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">kNN_regressor</span>(), X, Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>trained Machine; caches model-specific representations of data
  model: KNNRegressor(K = 5, …)
  args: 
    1:  Source @813 ⏎ Table{AbstractVector{Continuous}}
    2:  Source @952 ⏎ AbstractVector{Continuous}</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-49_d23b8052ea91d30f2be561cc630636ba">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>MLJ.<span class="fu">predict</span>(model, X)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element Vector{Float64}:
 5.18
 4.779999999999999
 4.68
 4.82
 5.0200000000000005</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="random-forest" class="level1">
<h1>Random forest</h1>
<p>The random forest (RF) algorithm is probably one of the most famous ML algorithms, and not without reason. Compared to other well performing algorithms, the RF algorithm has only a few hyper-parameters and because of the bagging and the random sampling of available variables in for the node splits, it has a well working internal complexity adaption.</p>
<p>In the following, we use the ‘ranger’ package (<span class="citation" data-cites="ranger">Wright and Ziegler (<a href="#ref-ranger" role="doc-biblioref">2017</a>)</span>) (Python: ‘scikit-learn’ (<span class="citation" data-cites="scikit-learn">(<a href="#ref-scikit-learn" role="doc-biblioref"><strong>scikit-learn?</strong></a>)</span>), Julia: ‘MLJ’ (<span class="citation" data-cites="anthony_blaom_2019_3541506">(<a href="#ref-anthony_blaom_2019_3541506" role="doc-biblioref"><strong>anthony_blaom_2019_3541506?</strong></a>)</span>)).</p>
<section id="classification-3" class="level2">
<h2 class="anchored" data-anchor-id="classification-3">Classification</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-51_7a36fe91f53a3b839aff155deb0594fb">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> iris[,<span class="dv">5</span>,drop<span class="ot">=</span><span class="cn">FALSE</span>]</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">cbind</span>(Y, X)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">=</span> <span class="fu">ranger</span>(Species<span class="sc">~</span>., <span class="at">data =</span> data, <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Show feature importances:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-52_78ba71cb811a2684c4752dedb91fd4fd">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">importance</span>(rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    8.286993     1.082122    44.062428    42.317936 </code></pre>
</div>
</div>
<p>Make predictions (class probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-53_8e36af5b293355528dbfd76f7435da18">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(rf, <span class="at">data =</span> data)<span class="sc">$</span>predictions, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     setosa versicolor virginica
[1,]      1          0         0
[2,]      1          0         0
[3,]      1          0         0</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-54_ff22e4f387ad768fd02a09114f5fbaff">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(iris.data)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris.target</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RandomForestClassifier().fit(X, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Feature importance</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-55_7ba3d73fc7f45f7390787367d9cff518">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.feature_importances_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.09634344 0.02539683 0.47027014 0.4079896 ]</code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-56_db896454f98f6146e959aa31c108763d">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>model.predict_proba(X)[<span class="dv">0</span>:<span class="dv">10</span>,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.],
       [1., 0., 0.]])</code></pre>
</div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-57_b4d1af2b7e350fca28335a42f1d5e1ba">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJ;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>RF_classifier <span class="op">=</span> <span class="pp">@load</span> RandomForestClassifier pkg<span class="op">=</span>DecisionTree;</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase;</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-58_808b1e096d3a36fbd3ac36a03cabc49d">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>]);</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">5</span>];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Models:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-59_43438e8d789e0e9959c094fb023e11ab">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">RF_classifier</span>(), X, Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>trained Machine; caches model-specific representations of data
  model: RandomForestClassifier(max_depth = -1, …)
  args: 
    1:  Source @122 ⏎ Table{AbstractVector{Continuous}}
    2:  Source @052 ⏎ AbstractVector{Multiclass{3}}</code></pre>
</div>
</div>
<p>Feature importance:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-60_ea878664bda27ca27abb12ff98c4dd58">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">feature_importances</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4-element Vector{Pair{Symbol, Float64}}:
  :PetalWidth =&gt; 0.6763620902021268
 :PetalLength =&gt; 0.22593482874364082
 :SepalLength =&gt; 0.07710378101476215
  :SepalWidth =&gt; 0.020599300039470164</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-61_00d196b6e74557e8dad0be146eb36e4b">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>MLJ.<span class="fu">predict</span>(model, X)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element CategoricalDistributions.UnivariateFiniteVector{Multiclass{3}, String, UInt8, Float64}:
 UnivariateFinite{Multiclass{3}}(setosa=&gt;1.0, versicolor=&gt;0.0, virginica=&gt;0.0)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;1.0, versicolor=&gt;0.0, virginica=&gt;0.0)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;1.0, versicolor=&gt;0.0, virginica=&gt;0.0)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;1.0, versicolor=&gt;0.0, virginica=&gt;0.0)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;1.0, versicolor=&gt;0.0, virginica=&gt;0.0)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="regression-3" class="level2">
<h2 class="anchored" data-anchor-id="regression-3">Regression</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-62_924173141f2f6efd15e2575699b41553">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> iris[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">cbind</span>(iris[,<span class="dv">1</span>,<span class="at">drop=</span><span class="cn">FALSE</span>], X)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">=</span> <span class="fu">ranger</span>(Sepal.Length<span class="sc">~</span>., <span class="at">data =</span> data, <span class="at">importance =</span> <span class="st">"impurity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Show feature importances:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-63_f16e6ccf7e37b8fbb59f59594ddcbc49">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">importance</span>(rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Sepal.Width Petal.Length  Petal.Width 
    12.07640     46.47415     37.01815 </code></pre>
</div>
</div>
<p>Make predictions (class probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-64_328a244b64d4794680d80c2c779e5004">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(rf, <span class="at">data =</span> data)<span class="sc">$</span>predictions, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.108284 4.760690 4.654140</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-65_f4c7813d2fb0a1109ff05e091022330d">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> iris.data</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(data[:,<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> data[:,<span class="dv">0</span>]</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RandomForestRegressor().fit(X, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Feature importance:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-66_a7ae9ae8e5a4539eb671326da118c9af">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.feature_importances_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.07806274 0.87417214 0.04776512]</code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-67_caefeadaef9b6fa1f9712d860d781feb">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>model.predict(X)[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([5.107     , 4.82175   , 4.56615   , 4.7669    , 4.996     ,
       5.4195    , 4.81833333, 5.05781667, 4.534     , 4.846     ])</code></pre>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-68_d0e69fe40eb2a71d005bb2dca279ec9a">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJ;</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>RF_regressor <span class="op">=</span> <span class="pp">@load</span> RandomForestRegressor pkg<span class="op">=</span>DecisionTree;</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-69_32fa188d7e47a616450199a60f2a34c8">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>]);</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">1</span>];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Model:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-70_05bf6352b570d9ac396ea873db6657f1">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">RF_regressor</span>(), X, Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>trained Machine; caches model-specific representations of data
  model: RandomForestRegressor(max_depth = -1, …)
  args: 
    1:  Source @395 ⏎ Table{AbstractVector{Continuous}}
    2:  Source @026 ⏎ AbstractVector{Continuous}</code></pre>
</div>
</div>
<p>Feature importance:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-71_d9775ad1ff510a11718ebfa3d1f3c6ab">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">feature_importances</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3-element Vector{Pair{Symbol, Float64}}:
 :PetalLength =&gt; 0.698229563002158
  :PetalWidth =&gt; 0.2411846110302036
  :SepalWidth =&gt; 0.060585825967638215</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-72_797d4bd010e7dddbac69ac37ca09ac8f">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>MLJ.<span class="fu">predict</span>(model, X)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element Vector{Float64}:
 5.08
 4.75
 4.525
 4.75
 5.0</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="boosted-gradient-trees" class="level1">
<h1>Boosted gradient trees</h1>
<p>Boosted gradient machines achieve currently state-of-the-art performance for structured (tabular) data which makes them probably one of the most important algorithms for E&amp;E where structured data dominates the field.</p>
<p>In the following, we use the ‘xgboost’ package (<span class="citation" data-cites="xgboost">Chen et al. (<a href="#ref-xgboost" role="doc-biblioref">2022</a>)</span>) (Python: ‘xgboost’ (<span class="citation" data-cites="xgboost">Chen et al. (<a href="#ref-xgboost" role="doc-biblioref">2022</a>)</span>), Julia: ‘MLJ’ (<span class="citation" data-cites="anthony_blaom_2019_3541506">(<a href="#ref-anthony_blaom_2019_3541506" role="doc-biblioref"><strong>anthony_blaom_2019_3541506?</strong></a>)</span>))</p>
<section id="classification-4" class="level2">
<h2 class="anchored" data-anchor-id="classification-4">Classification</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-74_c743143dbeb8d2843b13f39963ddc726">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> <span class="fu">as.integer</span>(iris[,<span class="dv">5</span>]) <span class="sc">-</span> <span class="dv">1</span> <span class="co"># classes must be integers starting from 0</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>xgdata <span class="ot">=</span> <span class="fu">xgb.DMatrix</span>(X, <span class="at">label =</span> Y)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="co"># nrounds = number of trees in the ensemble</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>brt <span class="ot">=</span> <span class="fu">xgboost</span>(<span class="at">data =</span> xgdata, </span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">objective=</span><span class="st">"multi:softprob"</span>, </span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrounds =</span> <span class="dv">50</span>, </span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">num_class =</span> <span class="dv">3</span>,</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">verbose =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Show feature importances:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-75_d51b2b5d7f218160d1e8f94cc9016116">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.importance</span>(<span class="at">model =</span> brt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Feature        Gain      Cover Frequency
1: Petal.Length 0.671879438 0.57441039 0.3792049
2:  Petal.Width 0.311535837 0.29261084 0.3088685
3:  Sepal.Width 0.010177107 0.04910115 0.1162080
4: Sepal.Length 0.006407618 0.08387763 0.1957187</code></pre>
</div>
</div>
<p>Make predictions (class probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-76_5cf10995c4bf45f06781ce9970a0d506">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">matrix</span>(<span class="fu">predict</span>(brt, <span class="at">newdata =</span> <span class="fu">xgb.DMatrix</span>(X)), <span class="at">ncol =</span><span class="dv">3</span>), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]        [,2]        [,3]
[1,] 0.995287061 0.002195822 0.001027058
[2,] 0.003323558 0.995396435 0.001592265
[3,] 0.001389398 0.002407764 0.997380674</code></pre>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-77_24d765e57449aac5c1e6143511099e07">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(iris.data)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris.target</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters:</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>param <span class="op">=</span> {</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">'max_depth'</span>:<span class="dv">2</span>, </span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">'eta'</span>:<span class="dv">1</span>, </span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">'objective'</span>:<span class="st">'multi:softmax'</span> }</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>num_round <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> xgb.XGBClassifier(param, num_round, verbosity <span class="op">=</span> <span class="dv">0</span>).fit(X, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Feature importance</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-78_0b64df8a023af4ad9b9df6a6b9d4de7a">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>model.feature_importances_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([0.00959796, 0.01645038, 0.6765859 , 0.29736578], dtype=float32)</code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-79_fa9bb979fb257ca3ffef6c661368f13d">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>model.predict_proba(X)[<span class="dv">0</span>:<span class="dv">10</span>,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[9.9680281e-01, 2.3831066e-03, 8.1413286e-04],
       [9.9636227e-01, 2.3820533e-03, 1.2557388e-03],
       [9.9680281e-01, 2.3831066e-03, 8.1413286e-04],
       [9.9679452e-01, 2.3830866e-03, 8.2237815e-04],
       [9.9680281e-01, 2.3831066e-03, 8.1413286e-04],
       [9.9680281e-01, 2.3831066e-03, 8.1413286e-04],
       [9.9680281e-01, 2.3831066e-03, 8.1413286e-04],
       [9.9680281e-01, 2.3831066e-03, 8.1413286e-04],
       [9.9636227e-01, 2.3820533e-03, 1.2557388e-03],
       [9.9679452e-01, 2.3830866e-03, 8.2237815e-04]], dtype=float32)</code></pre>
</div>
</div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-80_9f9e6fdd795c2d3956ac668786f6eeee">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJ;</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>BRT_classifier <span class="op">=</span> <span class="pp">@load</span> XGBoostClassifier pkg<span class="op">=</span>XGBoost;</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase;</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-81_a0c2e2833070570165dbafd987bf9edb">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>]);</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">5</span>];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Models:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-82_59cda142f67b7dde301b5e648329ab24">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">BRT_classifier</span>(), X, Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>trained Machine; caches model-specific representations of data
  model: XGBoostClassifier(num_round = 100, …)
  args: 
    1:  Source @735 ⏎ Table{AbstractVector{Continuous}}
    2:  Source @288 ⏎ AbstractVector{Multiclass{3}}</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-83_2308b3ec5f94836463d069d74b47d44a">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>MLJ.<span class="fu">predict</span>(model, X)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element CategoricalDistributions.UnivariateFiniteVector{Multiclass{3}, String, UInt8, Float32}:
 UnivariateFinite{Multiclass{3}}(setosa=&gt;0.997, versicolor=&gt;0.00238, virginica=&gt;0.000814)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;0.996, versicolor=&gt;0.00238, virginica=&gt;0.00126)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;0.997, versicolor=&gt;0.00238, virginica=&gt;0.000814)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;0.997, versicolor=&gt;0.00238, virginica=&gt;0.000822)
 UnivariateFinite{Multiclass{3}}(setosa=&gt;0.997, versicolor=&gt;0.00238, virginica=&gt;0.000814)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="regression-4" class="level2">
<h2 class="anchored" data-anchor-id="regression-4">Regression</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-84_679d96e9a319268b7e4d277c5427c899">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(iris[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> iris[,<span class="dv">1</span>]</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>xgdata <span class="ot">=</span> <span class="fu">xgb.DMatrix</span>(X, <span class="at">label =</span> Y)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co"># nrounds = number of trees in the ensemble</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>brt <span class="ot">=</span> <span class="fu">xgboost</span>(<span class="at">data =</span> xgdata, </span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">objective=</span><span class="st">"reg:squarederror"</span>, </span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrounds =</span> <span class="dv">50</span>, </span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">verbose =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Show feature importances:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-85_c0a0594c3429369d5e553a4690abc49a">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.importance</span>(<span class="at">model =</span> brt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Feature       Gain     Cover Frequency
1: Petal.Length 0.86781219 0.4789538 0.3789062
2:  Petal.Width 0.06987880 0.2128402 0.2626953
3:  Sepal.Width 0.06230901 0.3082060 0.3583984</code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-86_5a9876d05e6194cbbbd7627186a7d5dc">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(brt, <span class="at">newdata =</span> <span class="fu">xgb.DMatrix</span>(X), <span class="at">n =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[15:20:57] WARNING: amalgamation/../src/c_api/c_api.cc:785: `ntree_limit` is deprecated, use `iteration_range` instead.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.506606 3.506606 3.506606 3.506606 3.506606 3.506606</code></pre>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-87_387d9b2a0e744c46014717308becb385">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> iris.data</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(data[:,<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> data[:,<span class="dv">0</span>]</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters:</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> xgb.XGBRegressor(</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>  objective <span class="op">=</span> <span class="st">'reg:squarederror'</span>,</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>  max_depth <span class="op">=</span> <span class="dv">2</span>,  </span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>  n_estimators <span class="op">=</span> <span class="dv">50</span>, </span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>  verbosity <span class="op">=</span> <span class="dv">0</span>).fit(X, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Feature importance:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-88_8205d5c1757ee24d2a099f9ca0004eff">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.feature_importances_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.08471056 0.835755   0.07953447]</code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-89_3958f2a0b31b7b228eab2d6c3347824d">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>model.predict(X)[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([5.0407157, 4.6844926, 4.711238 , 4.917956 , 5.0407157, 5.450946 ,
       4.928966 , 4.986462 , 4.6750975, 4.917956 ], dtype=float32)</code></pre>
</div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-90_84e4df306b41548486315209df12afc1">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJ;</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>BRT_regressor <span class="op">=</span>  <span class="pp">@load</span> XGBoostRegressor pkg<span class="op">=</span>XGBoost;</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-91_4dea54098db7d3c6ae4773cf5fbed507">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>]);</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">1</span>];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Model:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-92_306553bf2b33c825a6d8f38337a7284c">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">fit!</span>(<span class="fu">machine</span>(<span class="fu">BRT_regressor</span>(), X, Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>trained Machine; caches model-specific representations of data
  model: XGBoostRegressor(num_round = 100, …)
  args: 
    1:  Source @496 ⏎ Table{AbstractVector{Continuous}}
    2:  Source @453 ⏎ AbstractVector{Continuous}</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-93_40b024e60c760b8694543804b4fafbc1">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>MLJ.<span class="fu">predict</span>(model, X)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element Vector{Float32}:
 5.1509466
 4.8569074
 4.551141
 4.7587333
 4.999504</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="deep-neural-networks" class="level1">
<h1>Deep neural networks</h1>
<p>Deep neural networks, or more precisely here fully connected neural networks, can be flexibly built which makes their application more challenging than other ML algorithms.</p>
<p>In the following, we use the ‘keras’ (<span class="citation" data-cites="kerasR">Allaire and Chollet (<a href="#ref-kerasR" role="doc-biblioref">2022</a>)</span>; <span class="citation" data-cites="chollet2015keras">Chollet et al. (<a href="#ref-chollet2015keras" role="doc-biblioref">2015</a>)</span>) (Python: ‘keras’ (<span class="citation" data-cites="chollet2015keras">Chollet et al. (<a href="#ref-chollet2015keras" role="doc-biblioref">2015</a>)</span>); Julia: ‘Flux’ (<span class="citation" data-cites="Flux">(<a href="#ref-Flux" role="doc-biblioref"><strong>Flux?</strong></a>)</span>)) package which is a higher level API on the python ‘tensorflow’ framework (<span class="citation" data-cites="abadi2016tensorflow">Abadi et al. (<a href="#ref-abadi2016tensorflow" role="doc-biblioref">2016</a>)</span>).</p>
<section id="classification-5" class="level2">
<h2 class="anchored" data-anchor-id="classification-5">Classification</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-95_d1686823c00778aaf7147a31943f82ee">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">scale</span>(<span class="fu">as.matrix</span>(iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]))</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> <span class="fu">as.integer</span>(iris<span class="sc">$</span>Species)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to one hot encode our response classes</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>YT <span class="ot">=</span> <span class="fu">k_one_hot</span>(Y<span class="sc">-</span>1L, <span class="at">num_classes =</span> <span class="dv">3</span>)</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>DNN <span class="ot">=</span> <span class="fu">keras_model_sequential</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first hidden layer</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">input_shape =</span> <span class="fu">ncol</span>(X), </span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">units =</span> <span class="dv">10</span>, </span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># second hidden layer with regularization</span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">20</span>, </span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">activation =</span> <span class="st">"relu"</span>,</span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">kernel_regularizer =</span> <span class="fu">regularizer_l1</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output layer, 3 output neurons for our three classes</span></span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and softmax activation to get quasi probabilities </span></span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># that sum up to 1 for each observation</span></span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">3</span>, </span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">activation =</span> <span class="st">"softmax"</span>)</span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-22"><a href="#cb143-22" aria-hidden="true" tabindex="-1"></a><span class="co"># print architecture</span></span>
<span id="cb143-23"><a href="#cb143-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(DNN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "sequential"
________________________________________________________________________________
 Layer (type)                       Output Shape                    Param #     
================================================================================
 dense_2 (Dense)                    (None, 10)                      50          
 dense_1 (Dense)                    (None, 20)                      220         
 dense (Dense)                      (None, 3)                       63          
================================================================================
Total params: 333
Trainable params: 333
Non-trainable params: 0
________________________________________________________________________________</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add loss function and optimizer</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>DNN <span class="sc">%&gt;%</span> </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compile</span>(<span class="at">loss =</span> loss_categorical_crossentropy,</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">optimizer =</span> <span class="fu">optimizer_adamax</span>(<span class="fl">0.01</span>))</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="co"># train model</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>DNN <span class="sc">%&gt;%</span> </span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(X, YT, <span class="at">epochs =</span> <span class="dv">50</span>, <span class="at">verbose =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make predictions (class probabilities):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-96_54712a92a28676c280f27f98a927db0c">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(DNN, X), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]        [,2]         [,3]
[1,] 0.9964795 0.003511276 9.235719e-06
[2,] 0.9948555 0.005123273 2.117410e-05
[3,] 0.9980750 0.001919746 5.270147e-06</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-97_9877258590f11d0c60ef4b2753456ee4">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> <span class="op">*</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(iris.data)</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> iris.target</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to one hot encode our response classes</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>YT <span class="op">=</span> keras.utils.to_categorical(Y, num_classes <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>DNN <span class="op">=</span> keras.Sequential()</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first hidden layer</span></span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>DNN.add(Dense(</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>  input_shape<span class="op">=</span>[X.shape[<span class="dv">1</span>]], </span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>  units <span class="op">=</span> <span class="dv">10</span>, </span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a>  activation <span class="op">=</span> <span class="st">"relu"</span>)) </span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># second hidden layer with regularization</span></span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>DNN.add(Dense(</span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>  units <span class="op">=</span> <span class="dv">20</span>, </span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a>  activation <span class="op">=</span> <span class="st">"relu"</span>,</span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>  kernel_regularizer <span class="op">=</span> keras.regularizers.l1()))</span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output layer, 3 output neurons for our three classes</span></span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and softmax activation to get quasi probabilities </span></span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># that sum up to 1 for each observation</span></span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a>DNN.add(Dense(</span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a>  units <span class="op">=</span> <span class="dv">3</span>, </span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a>  activation <span class="op">=</span> <span class="st">"softmax"</span>))</span>
<span id="cb148-29"><a href="#cb148-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-30"><a href="#cb148-30" aria-hidden="true" tabindex="-1"></a><span class="co"># print architecture</span></span>
<span id="cb148-31"><a href="#cb148-31" aria-hidden="true" tabindex="-1"></a>DNN.summary()</span>
<span id="cb148-32"><a href="#cb148-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-33"><a href="#cb148-33" aria-hidden="true" tabindex="-1"></a><span class="co"># add loss function and optimizer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "sequential_1"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 dense_3 (Dense)             (None, 10)                50        
                                                                 
 dense_4 (Dense)             (None, 20)                220       
                                                                 
 dense_5 (Dense)             (None, 3)                 63        
                                                                 
=================================================================
Total params: 333
Trainable params: 333
Non-trainable params: 0
_________________________________________________________________</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>DNN.<span class="bu">compile</span>(loss <span class="op">=</span> keras.losses.categorical_crossentropy,</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>            optimizer <span class="op">=</span> keras.optimizers.Adamax(<span class="fl">0.01</span>))</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co"># train model</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>DNN.fit(X, YT, epochs <span class="op">=</span> <span class="dv">50</span>, verbose <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;keras.callbacks.History object at 0x7fd386fd0f70&gt;</code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-98_0443fb9837810dfca8f97db9750b6588">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>DNN.predict(X)[<span class="dv">0</span>:<span class="dv">10</span>,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
1/5 [=====&gt;........................] - ETA: 0s
5/5 [==============================] - 0s 696us/step
array([[9.9728423e-01, 2.5469568e-03, 1.6875175e-04],
       [9.8199153e-01, 1.7638901e-02, 3.6973268e-04],
       [9.9636793e-01, 3.4390234e-03, 1.9302260e-04],
       [9.9362051e-01, 6.1033601e-03, 2.7610915e-04],
       [9.9864072e-01, 1.2317772e-03, 1.2755694e-04],
       [9.9758422e-01, 2.1763707e-03, 2.3943538e-04],
       [9.9849594e-01, 1.3219559e-03, 1.8212432e-04],
       [9.9596071e-01, 3.8257015e-03, 2.1353990e-04],
       [9.9137890e-01, 8.3161285e-03, 3.0487700e-04],
       [9.8814315e-01, 1.1592858e-02, 2.6392430e-04]], dtype=float32)</code></pre>
</div>
</div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-99_7e1a0f567863292f01a8b95542e81587">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">MLJBase.int</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux</span>, <span class="bu">Statistics</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux.Data</span>: DataLoader</span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux</span>: onehotbatch, onecold, @epochs</span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux.Losses</span>: logitcrossentropy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Data preparation:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-100_740db772cf1274bb4a414581ada0ebf3">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">transpose</span>(<span class="fu">Matrix</span>(<span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>])));</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> <span class="fu">int</span>(iris[<span class="op">:</span>, <span class="fl">5</span>], <span class="kw">type</span> <span class="op">=</span> <span class="dt">Int</span>);</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(Y));</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>YT <span class="op">=</span> <span class="fu">onehotbatch</span>(Y, classes);</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>data_loader <span class="op">=</span> <span class="fu">DataLoader</span>((X, YT), batchsize<span class="op">=</span><span class="fl">10</span>, shuffle<span class="op">=</span><span class="cn">true</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create model (similar to Keras):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-101_954a9700403c8e13edcabe53e42a519b">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">Chain</span>(</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Dense</span>(<span class="fl">4</span>, <span class="fl">20</span>, relu),</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Dense</span>(<span class="fl">20</span>, <span class="fl">20</span>, relu),</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Dense</span>(<span class="fl">20</span>, <span class="fl">3</span>)</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain(
  Dense(4 =&gt; 20, relu),                 # 100 parameters
  Dense(20 =&gt; 20, relu),                # 420 parameters
  Dense(20 =&gt; 3),                       # 63 parameters
)                   # Total: 6 arrays, 583 parameters, 2.652 KiB.</code></pre>
</div>
</div>
<p>Train/optimize Model:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-102_fbc5d5f027eb790b33d5900f53ab7d63">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> Flux.<span class="fu">params</span>(model);</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> <span class="fu">ADAM</span>(<span class="fl">0.01</span>);</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Help functions</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="fu">loss</span>(x, y) <span class="op">=</span> <span class="fu">logitcrossentropy</span>(<span class="fu">model</span>(x), y);</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a><span class="fu">get_loss</span>() <span class="op">=</span> <span class="pp">@show</span> <span class="fu">sum</span>(<span class="fu">logitcrossentropy</span>(<span class="fu">model</span>(X), YT));</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Training</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>  Flux.<span class="fu">train!</span>(loss, parameters, data_loader, optimizer, cb <span class="op">=</span> Flux.<span class="fu">throttle</span>(get_loss, <span class="fl">5</span>))</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sum(logitcrossentropy(model(X), YT)) = 0.9137276848326848
sum(logitcrossentropy(model(X), YT)) = 0.33742182994740494
sum(logitcrossentropy(model(X), YT)) = 0.24112261934184942
sum(logitcrossentropy(model(X), YT)) = 0.17922425396390598
sum(logitcrossentropy(model(X), YT)) = 0.13402635917766453
sum(logitcrossentropy(model(X), YT)) = 0.09795579050502815
sum(logitcrossentropy(model(X), YT)) = 0.08437842036788658
sum(logitcrossentropy(model(X), YT)) = 0.08676334422694802
sum(logitcrossentropy(model(X), YT)) = 0.059077187063716445
sum(logitcrossentropy(model(X), YT)) = 0.0540547582343783
sum(logitcrossentropy(model(X), YT)) = 0.0504386910567336
sum(logitcrossentropy(model(X), YT)) = 0.06521044006258417
sum(logitcrossentropy(model(X), YT)) = 0.06983071086023637
sum(logitcrossentropy(model(X), YT)) = 0.047340938848310817
sum(logitcrossentropy(model(X), YT)) = 0.053024142614686506
sum(logitcrossentropy(model(X), YT)) = 0.06808428705465261
sum(logitcrossentropy(model(X), YT)) = 0.12618972238841328
sum(logitcrossentropy(model(X), YT)) = 0.06775723711189076
sum(logitcrossentropy(model(X), YT)) = 0.0674506553997516
sum(logitcrossentropy(model(X), YT)) = 0.06385161088830288</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-103_e4b506f3c6e797e41177391ec0bf8c4c">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">transpose</span>(<span class="fu">softmax</span>(<span class="fu">model</span>(X)))[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">:</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5×3 Matrix{Float64}:
 0.999989  1.10783e-5   3.90833e-10
 0.999884  0.000116151  9.44728e-10
 0.999979  2.08204e-5   2.5391e-10
 0.999954  4.64704e-5   4.52045e-10
 0.999994  6.46387e-6   2.59327e-10</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="regression-5" class="level2">
<h2 class="anchored" data-anchor-id="regression-5">Regression</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-3" role="tab" aria-controls="tabset-12-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-104_ecfee3bc02438d44bdd5b58f673d1b9a">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">scale</span>(<span class="fu">as.matrix</span>(iris[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]))</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> <span class="fu">as.matrix</span>(iris[,<span class="dv">1</span>,<span class="at">drop=</span><span class="cn">FALSE</span>])</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>DNN <span class="ot">=</span> <span class="fu">keras_model_sequential</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first hidden layer</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">input_shape =</span> <span class="fu">ncol</span>(X), </span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">units =</span> <span class="dv">10</span>, </span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># second hidden layer with regularization</span></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">20</span>, </span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">activation =</span> <span class="st">"relu"</span>,</span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">kernel_regularizer =</span> <span class="fu">regularizer_l1</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output layer, one output neuron for one response</span></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and no activation function</span></span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">1</span>)</span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a><span class="co"># print architecture</span></span>
<span id="cb162-19"><a href="#cb162-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(DNN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "sequential_2"
________________________________________________________________________________
 Layer (type)                       Output Shape                    Param #     
================================================================================
 dense_8 (Dense)                    (None, 10)                      40          
 dense_7 (Dense)                    (None, 20)                      220         
 dense_6 (Dense)                    (None, 1)                       21          
================================================================================
Total params: 281
Trainable params: 281
Non-trainable params: 0
________________________________________________________________________________</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add loss function and optimizer</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>DNN <span class="sc">%&gt;%</span> </span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compile</span>(<span class="at">loss =</span> loss_mean_squared_error,</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">optimizer =</span> <span class="fu">optimizer_adamax</span>(<span class="fl">0.01</span>))</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="co"># train model</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>DNN <span class="sc">%&gt;%</span> </span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(X, YT, <span class="at">epochs =</span> <span class="dv">50</span>, <span class="at">verbose =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-105_ef11635f11b01ec529102b9f30a20ead">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(DNN, X), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]
[1,] 0.3342652
[2,] 0.3345078
[3,] 0.3343914</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-106_c26f4dca2221da9f2193da8f05ef3c6e">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> <span class="op">*</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> iris.data</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scale(data[:,<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> data[:,<span class="dv">0</span>]</span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>DNN <span class="op">=</span> keras.Sequential()</span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first hidden layer</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>DNN.add(Dense(</span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>  input_shape<span class="op">=</span>[X.shape[<span class="dv">1</span>]], </span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>  units <span class="op">=</span> <span class="dv">10</span>, </span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a>  activation <span class="op">=</span> <span class="st">"relu"</span>)) </span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># second hidden layer with regularization</span></span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a>DNN.add(Dense(</span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a>  units <span class="op">=</span> <span class="dv">20</span>, </span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a>  activation <span class="op">=</span> <span class="st">"relu"</span>,</span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a>  kernel_regularizer <span class="op">=</span> keras.regularizers.l1()))</span>
<span id="cb167-21"><a href="#cb167-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output layer, 3 output neurons for our three classes</span></span>
<span id="cb167-22"><a href="#cb167-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and softmax activation to get quasi probabilities </span></span>
<span id="cb167-23"><a href="#cb167-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># that sum up to 1 for each observation</span></span>
<span id="cb167-24"><a href="#cb167-24" aria-hidden="true" tabindex="-1"></a>DNN.add(Dense(</span>
<span id="cb167-25"><a href="#cb167-25" aria-hidden="true" tabindex="-1"></a>  units <span class="op">=</span> <span class="dv">1</span>, </span>
<span id="cb167-26"><a href="#cb167-26" aria-hidden="true" tabindex="-1"></a>  activation <span class="op">=</span> <span class="va">None</span>))</span>
<span id="cb167-27"><a href="#cb167-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-28"><a href="#cb167-28" aria-hidden="true" tabindex="-1"></a><span class="co"># print architecture</span></span>
<span id="cb167-29"><a href="#cb167-29" aria-hidden="true" tabindex="-1"></a>DNN.summary()</span>
<span id="cb167-30"><a href="#cb167-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-31"><a href="#cb167-31" aria-hidden="true" tabindex="-1"></a><span class="co"># add loss function and optimizer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "sequential_3"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 dense_9 (Dense)             (None, 10)                40        
                                                                 
 dense_10 (Dense)            (None, 20)                220       
                                                                 
 dense_11 (Dense)            (None, 1)                 21        
                                                                 
=================================================================
Total params: 281
Trainable params: 281
Non-trainable params: 0
_________________________________________________________________</code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>DNN.<span class="bu">compile</span>(loss <span class="op">=</span> keras.losses.mean_squared_error,</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>            optimizer <span class="op">=</span> keras.optimizers.Adamax(<span class="fl">0.01</span>))</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="co"># train model</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>DNN.fit(X, Y, epochs <span class="op">=</span> <span class="dv">50</span>, verbose <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;keras.callbacks.History object at 0x7fd33272aa60&gt;</code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-107_1751858c3a1e83003e2794cb9a198db6">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>DNN.predict(X)[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
1/5 [=====&gt;........................] - ETA: 0s
5/5 [==============================] - 0s 2ms/step
array([[5.083273 ],
       [4.701537 ],
       [4.804775 ],
       [4.7482758],
       [5.183096 ],
       [5.3010855],
       [4.9102583],
       [4.971752 ],
       [4.635595 ],
       [4.8358707]], dtype=float32)</code></pre>
</div>
</div>
</div>
<div id="tabset-12-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-108_4ab8a4716b3d6934c6a3382bf94553aa">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">MLJBase.int</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux</span>, <span class="bu">Statistics</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux.Data</span>: DataLoader</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux</span>: onehotbatch, onecold, @epochs</span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux.Losses</span>: mse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Data preparation:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-109_b2bb8aac32cf9a188b9c5bc7752e15e3">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>);</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">transpose</span>(<span class="fu">Matrix</span>(<span class="fu">mapcols</span>(StatsBase.zscore, iris[<span class="op">:</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>])));</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>YT <span class="op">=</span> iris[<span class="op">:</span>, <span class="fl">1</span>];</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>YT <span class="op">=</span> <span class="fu">reshape</span>(YT, <span class="fl">1</span>, <span class="fu">length</span>(YT));</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>data_loader <span class="op">=</span> <span class="fu">DataLoader</span>((X, YT), batchsize<span class="op">=</span><span class="fl">10</span>, shuffle<span class="op">=</span><span class="cn">true</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create model (similar to Keras):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-110_fd51f95e325eb8f5dea96598cfeb830b">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">Chain</span>(</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Dense</span>(<span class="fl">3</span>, <span class="fl">20</span>, relu),</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Dense</span>(<span class="fl">20</span>, <span class="fl">20</span>, relu),</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Dense</span>(<span class="fl">20</span>, <span class="fl">1</span>)</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain(
  Dense(3 =&gt; 20, relu),                 # 80 parameters
  Dense(20 =&gt; 20, relu),                # 420 parameters
  Dense(20 =&gt; 1),                       # 21 parameters
)                   # Total: 6 arrays, 521 parameters, 2.410 KiB.</code></pre>
</div>
</div>
<p>Train/optimize Model:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-111_7b740acabd9942b45a57ff29350a6d1c">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> Flux.<span class="fu">params</span>(model);</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> <span class="fu">ADAM</span>(<span class="fl">0.01</span>);</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Help functions</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="fu">loss</span>(x, y) <span class="op">=</span> <span class="fu">mse</span>(<span class="fu">model</span>(x), y);</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="fu">get_loss</span>() <span class="op">=</span> <span class="pp">@show</span> <span class="fu">sum</span>(<span class="fu">mse</span>(<span class="fu">model</span>(X), YT));</span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Training</span></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a>  Flux.<span class="fu">train!</span>(loss, parameters, data_loader, optimizer, cb <span class="op">=</span> Flux.<span class="fu">throttle</span>(get_loss, <span class="fl">5</span>))</span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sum(mse(model(X), YT)) = 36.46875940549919
sum(mse(model(X), YT)) = 8.364865751339352
sum(mse(model(X), YT)) = 2.6509183592892387
sum(mse(model(X), YT)) = 1.459001042186789
sum(mse(model(X), YT)) = 0.7810375451341784
sum(mse(model(X), YT)) = 0.5391416489736597
sum(mse(model(X), YT)) = 0.4007257096339796
sum(mse(model(X), YT)) = 0.30517873863519585
sum(mse(model(X), YT)) = 0.20032736446520263
sum(mse(model(X), YT)) = 0.18176509639870025
sum(mse(model(X), YT)) = 0.13507576994868223
sum(mse(model(X), YT)) = 0.13079353646033387
sum(mse(model(X), YT)) = 0.11852726886731574
sum(mse(model(X), YT)) = 0.11715182364468563
sum(mse(model(X), YT)) = 0.09674717937661666
sum(mse(model(X), YT)) = 0.09500097271223597
sum(mse(model(X), YT)) = 0.09704876293202064
sum(mse(model(X), YT)) = 0.09771871442041166
sum(mse(model(X), YT)) = 0.10478221947513959
sum(mse(model(X), YT)) = 0.11328532674158032</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-112_d5da2bc768208f5d0a1c463e6ec83d35">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">transpose</span>(<span class="fu">model</span>(X))[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5-element Vector{Float64}:
 5.160295031707646
 4.678109849227023
 4.8449876879878335
 4.793275882745976
 5.218784954784774</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="convolutional-neural-networks" class="level1">
<h1>Convolutional neural networks</h1>
<p>Convolutional neural networks (CNN) are also deep neural networks but they are based on convolutional layers, which is a biologically inspired variation optimized to process image-based data (<span class="citation" data-cites="lecun2015deep">LeCun, Bengio, and Hinton (<a href="#ref-lecun2015deep" role="doc-biblioref">2015</a>)</span>). CNNs consist of two stages, in the first, the images are passed through convolutional layers and the models learns to detect edges and shapes in the images. In the second stage, the dimensions are dropped and fully-connected layers are used to classify the previously identified shapes.</p>
<p>In the following, we will use again the ‘keras’ package (Python: ‘keras’ (<span class="citation" data-cites="chollet2015keras">Chollet et al. (<a href="#ref-chollet2015keras" role="doc-biblioref">2015</a>)</span>); Julia: ‘Flux’ (<span class="citation" data-cites="Flux">(<a href="#ref-Flux" role="doc-biblioref"><strong>Flux?</strong></a>)</span>)) but we will not differentiate between classification and regression because the only difference would be to change the last layer and the loss function (see section ‘Deep neural networks’).</p>
<p>We will demonstrate the application of CNNs with the MNIST dataset which consists of handwritten digits. The objective of the CNNs is to classify the images. The MNIST dataset is one of the most famous benchmark dataset for image-based tasks (<span class="citation" data-cites="lecun_mnist_2010">LeCun, Cortes, and Burges (<a href="#ref-lecun_mnist_2010" role="doc-biblioref">2010</a>)</span>).</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-3" role="tab" aria-controls="tabset-13-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-114_c02cf945f227d7b16b77ee00eed9eefa">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> keras<span class="sc">::</span><span class="fu">dataset_mnist</span>()</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> data<span class="sc">$</span>train</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> train<span class="sc">$</span>x<span class="sc">/</span><span class="dv">255</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="co"># we have to add a dimension that </span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a><span class="co"># informs the network about the channels</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="co"># of the images</span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">array</span>(X, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">dim</span>(X), <span class="dv">1</span>))</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>YT <span class="ot">=</span> <span class="fu">k_one_hot</span>(train<span class="sc">$</span>y, <span class="at">num_classes =</span> <span class="dv">10</span>)</span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>CNN <span class="ot">=</span> </span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keras_model_sequential</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first hidden layer</span></span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_conv_2d</span>(<span class="at">input_shape =</span> <span class="fu">list</span>(<span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>), </span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">filters =</span> <span class="dv">16</span>,</span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">kernel_size =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_average_pooling_2d</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_conv_2d</span>(<span class="at">filters =</span> <span class="dv">8</span>,</span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">kernel_size =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we use a normal DNN on top of the CNN:</span></span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the layer flatten will remove the additional </span></span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dimensions</span></span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_flatten</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">20</span>, </span>
<span id="cb181-29"><a href="#cb181-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb181-30"><a href="#cb181-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 10 output neurons for 10 classes</span></span>
<span id="cb181-31"><a href="#cb181-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">10</span>, </span>
<span id="cb181-32"><a href="#cb181-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">activation =</span> <span class="st">"softmax"</span>)</span>
<span id="cb181-33"><a href="#cb181-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-34"><a href="#cb181-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-35"><a href="#cb181-35" aria-hidden="true" tabindex="-1"></a><span class="co"># print architecture</span></span>
<span id="cb181-36"><a href="#cb181-36" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CNN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "sequential_4"
________________________________________________________________________________
 Layer (type)                       Output Shape                    Param #     
================================================================================
 conv2d_1 (Conv2D)                  (None, 27, 27, 16)              80          
 average_pooling2d (AveragePooling2  (None, 13, 13, 16)             0           
 D)                                                                             
 conv2d (Conv2D)                    (None, 12, 12, 8)               520         
 flatten (Flatten)                  (None, 1152)                    0           
 dense_13 (Dense)                   (None, 20)                      23060       
 dense_12 (Dense)                   (None, 10)                      210         
================================================================================
Total params: 23,870
Trainable params: 23,870
Non-trainable params: 0
________________________________________________________________________________</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add loss function and optimizer</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>CNN <span class="sc">%&gt;%</span> </span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compile</span>(<span class="at">loss =</span> loss_categorical_crossentropy,</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">optimizer =</span> <span class="fu">optimizer_adamax</span>(<span class="fl">0.01</span>))</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>CNN <span class="sc">%&gt;%</span> </span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(X, YT, <span class="at">epochs =</span> <span class="dv">3</span>, <span class="at">batch_size =</span> <span class="dv">125</span>, <span class="at">verbose =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make predictions (class probabilites):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-115_bef05f847595d53b1da799e639e82a47">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(CNN, X[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,,,,<span class="at">drop=</span><span class="cn">FALSE</span>]), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]         [,2]         [,3]         [,4]         [,5]
[1,] 3.100817e-10 2.610663e-09 1.016014e-06 1.302826e-01 1.815817e-11
[2,] 9.997821e-01 2.771531e-10 1.339885e-04 1.715268e-08 6.429019e-08
[3,] 5.847580e-09 1.353415e-05 1.005252e-04 1.313565e-05 9.986499e-01
             [,6]         [,7]         [,8]         [,9]        [,10]
[1,] 8.696761e-01 2.345545e-09 4.659744e-07 5.498057e-06 3.408277e-05
[2,] 9.474595e-07 3.830077e-05 2.035396e-07 4.028704e-05 3.999669e-06
[3,] 9.655837e-07 9.057882e-08 3.360263e-04 1.118681e-05 8.746434e-04</code></pre>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-116_23757bdac919526888bd283bcbe3d7d6">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> <span class="op">*</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> keras.datasets.mnist.load_data()</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> data[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> data[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to one hot encode our response classes</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>YT <span class="op">=</span> keras.utils.to_categorical(labels, num_classes <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>CNN <span class="op">=</span> keras.Sequential()</span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first hidden layer</span></span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a>CNN.add(Conv2D(input_shape <span class="op">=</span> [<span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>], </span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a>                filters <span class="op">=</span> <span class="dv">16</span>,</span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a>                kernel_size <span class="op">=</span> (<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a>                activation <span class="op">=</span> <span class="st">"relu"</span>))</span>
<span id="cb186-16"><a href="#cb186-16" aria-hidden="true" tabindex="-1"></a>CNN.add(AveragePooling2D())</span>
<span id="cb186-17"><a href="#cb186-17" aria-hidden="true" tabindex="-1"></a>CNN.add(Conv2D(filters <span class="op">=</span> <span class="dv">8</span>,</span>
<span id="cb186-18"><a href="#cb186-18" aria-hidden="true" tabindex="-1"></a>                kernel_size <span class="op">=</span> (<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb186-19"><a href="#cb186-19" aria-hidden="true" tabindex="-1"></a>                activation <span class="op">=</span> <span class="st">"relu"</span>))</span>
<span id="cb186-20"><a href="#cb186-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we use a normal DNN on top of the CNN:</span></span>
<span id="cb186-21"><a href="#cb186-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the layer flatten will remove the additional </span></span>
<span id="cb186-22"><a href="#cb186-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dimensions</span></span>
<span id="cb186-23"><a href="#cb186-23" aria-hidden="true" tabindex="-1"></a>CNN.add(Flatten())</span>
<span id="cb186-24"><a href="#cb186-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output layer, 3 output neurons for our three classes</span></span>
<span id="cb186-25"><a href="#cb186-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and softmax activation to get quasi probabilities </span></span>
<span id="cb186-26"><a href="#cb186-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># that sum up to 1 for each observation</span></span>
<span id="cb186-27"><a href="#cb186-27" aria-hidden="true" tabindex="-1"></a>CNN.add(Dense(</span>
<span id="cb186-28"><a href="#cb186-28" aria-hidden="true" tabindex="-1"></a>  units <span class="op">=</span> <span class="dv">10</span>, </span>
<span id="cb186-29"><a href="#cb186-29" aria-hidden="true" tabindex="-1"></a>  activation <span class="op">=</span> <span class="st">"softmax"</span>))</span>
<span id="cb186-30"><a href="#cb186-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-31"><a href="#cb186-31" aria-hidden="true" tabindex="-1"></a><span class="co"># print architecture</span></span>
<span id="cb186-32"><a href="#cb186-32" aria-hidden="true" tabindex="-1"></a>CNN.summary()</span>
<span id="cb186-33"><a href="#cb186-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-34"><a href="#cb186-34" aria-hidden="true" tabindex="-1"></a><span class="co"># add loss function and optimizer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "sequential_5"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 conv2d_2 (Conv2D)           (None, 27, 27, 16)        80        
                                                                 
 average_pooling2d_1 (Averag  (None, 13, 13, 16)       0         
 ePooling2D)                                                     
                                                                 
 conv2d_3 (Conv2D)           (None, 12, 12, 8)         520       
                                                                 
 flatten_1 (Flatten)         (None, 1152)              0         
                                                                 
 dense_14 (Dense)            (None, 10)                11530     
                                                                 
=================================================================
Total params: 12,130
Trainable params: 12,130
Non-trainable params: 0
_________________________________________________________________</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>CNN.<span class="bu">compile</span>(loss <span class="op">=</span> keras.losses.categorical_crossentropy,</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>            optimizer <span class="op">=</span> keras.optimizers.Adamax(<span class="fl">0.01</span>))</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a><span class="co"># train model</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>CNN.fit(train, YT, epochs <span class="op">=</span> <span class="dv">5</span>, verbose <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;keras.callbacks.History object at 0x7fd475b65460&gt;</code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-117_f0ea316e918ca5415ddb681dca303273">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>CNN.predict(train[<span class="dv">0</span>:<span class="dv">10</span>,:,:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
1/1 [==============================] - ETA: 0s
1/1 [==============================] - 0s 48ms/step
array([[6.14434545e-12, 3.59446334e-10, 1.28703402e-11, 2.49354099e-03,
        8.47030996e-13, 9.97506320e-01, 5.85586744e-12, 6.56106058e-09,
        5.51145547e-08, 5.39037934e-08],
       [9.99998391e-01, 1.52362081e-11, 3.78788457e-07, 2.26718214e-10,
        8.50213178e-10, 1.50934520e-09, 5.43428882e-07, 1.65367910e-11,
        3.26160432e-07, 2.11582645e-07],
       [2.45391665e-17, 1.66947564e-06, 2.46966503e-10, 3.17743454e-09,
        9.99996603e-01, 2.55985988e-09, 1.21114707e-13, 1.63704684e-07,
        4.20280877e-08, 1.48860840e-06],
       [1.36748557e-10, 9.99900877e-01, 4.66962774e-06, 6.48567777e-08,
        2.08451565e-05, 3.95428401e-08, 2.32822437e-08, 7.30964166e-05,
        3.16129046e-07, 2.58855204e-09],
       [8.45189418e-10, 3.79213603e-08, 1.57231757e-08, 7.69748354e-08,
        5.68999269e-04, 4.51519738e-10, 4.46595235e-12, 8.77998173e-05,
        8.18457522e-07, 9.99342263e-01],
       [6.88127940e-12, 1.37200216e-08, 9.99981463e-01, 8.86379254e-08,
        1.80766779e-08, 3.23394117e-10, 2.59790887e-11, 4.76991566e-08,
        1.77178754e-05, 6.40547910e-07],
       [1.17038240e-07, 9.99975979e-01, 6.71344935e-07, 7.53942550e-06,
        8.14225700e-08, 2.26627650e-09, 4.64865650e-07, 1.14708975e-07,
        1.49680081e-05, 8.67093775e-09],
       [2.53855147e-14, 1.54341568e-12, 1.41259306e-07, 9.99996364e-01,
        4.53533641e-13, 1.32219225e-06, 6.99642183e-18, 1.29509687e-07,
        4.76722846e-07, 1.54626241e-06],
       [7.42939221e-08, 9.99994993e-01, 3.55746351e-07, 4.64192027e-08,
        6.10087483e-08, 7.62304264e-09, 1.26993783e-07, 4.15602926e-06,
        9.89197346e-08, 9.41557587e-08],
       [4.01711953e-09, 1.02105275e-07, 2.50191956e-09, 1.25243088e-11,
        9.99986649e-01, 8.12461556e-11, 2.16738953e-11, 1.31477714e-06,
        1.19685619e-05, 1.47784788e-11]], dtype=float32)</code></pre>
</div>
</div>
</div>
<div id="tabset-13-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-118_e06077737ae09b47ae65a229cccb7239">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">MLJBase.int</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLDatasets</span>: MNIST</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux</span>, <span class="bu">Statistics</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux.Data</span>: DataLoader</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux</span>: onehotbatch, onecold, @epochs</span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux.Losses</span>: logitcrossentropy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Data preparation:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-119_2e3d75b581d6b2d96188c1df52de7ec9">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="cn">ENV</span>[<span class="st">"DATADEPS_ALWAYS_ACCEPT"</span>] <span class="op">=</span> <span class="st">"true"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>"true"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>xtrain, ytrain <span class="op">=</span> <span class="fu">MNIST</span>(<span class="op">:</span>train)[<span class="op">:</span>];</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>xtrain <span class="op">=</span> <span class="fu">reshape</span>(xtrain<span class="op">/</span><span class="fl">255</span>., <span class="fl">28</span>, <span class="fl">28</span>, <span class="fl">1</span>, <span class="fl">60000</span>);</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>ytrain <span class="op">=</span> <span class="fu">onehotbatch</span>(ytrain, <span class="fl">0</span><span class="op">:</span><span class="fl">9</span>);</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>data_loader <span class="op">=</span> <span class="fu">DataLoader</span>((xtrain, ytrain), batchsize<span class="op">=</span><span class="fl">100</span>, shuffle<span class="op">=</span><span class="cn">true</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create model (similar to Keras):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-120_afa6976b734e61dfdaade6bb58a04d11">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">Chain</span>(</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Conv</span>((<span class="fl">2</span>, <span class="fl">2</span>), <span class="fl">1</span><span class="op">=&gt;</span><span class="fl">16</span>, pad <span class="op">=</span> (<span class="fl">1</span>, <span class="fl">1</span>), relu),</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">MeanPool</span>((<span class="fl">2</span>, <span class="fl">2</span>)),</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Conv</span>((<span class="fl">2</span>, <span class="fl">2</span>), <span class="fl">16</span><span class="op">=&gt;</span><span class="fl">8</span>, pad <span class="op">=</span> (<span class="fl">1</span>, <span class="fl">1</span>), relu),</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">MeanPool</span>((<span class="fl">2</span>, <span class="fl">2</span>)),</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>  Flux.flatten,</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Dense</span>(<span class="fl">392</span>, <span class="fl">20</span>, relu),</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Dense</span>(<span class="fl">20</span>, <span class="fl">10</span>)</span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain(
  Conv((2, 2), 1 =&gt; 16, relu, pad=1),   # 80 parameters
  MeanPool((2, 2)),
  Conv((2, 2), 16 =&gt; 8, relu, pad=1),   # 520 parameters
  MeanPool((2, 2)),
  Flux.flatten,
  Dense(392 =&gt; 20, relu),               # 7_860 parameters
  Dense(20 =&gt; 10),                      # 210 parameters
)                   # Total: 8 arrays, 8_670 parameters, 34.977 KiB.</code></pre>
</div>
</div>
<p>Train/optimize Model:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-121_c2a172b046bf9299a777f28dca4006b4">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> Flux.<span class="fu">params</span>(model);</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> <span class="fu">ADAM</span>(<span class="fl">0.01</span>);</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Help functions</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="fu">loss</span>(x, y) <span class="op">=</span> <span class="fu">logitcrossentropy</span>(<span class="fu">model</span>(x), y);</span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="fu">get_loss</span>() <span class="op">=</span> <span class="pp">@show</span> <span class="fu">sum</span>(<span class="fu">logitcrossentropy</span>(<span class="fu">model</span>(xtrain[<span class="op">:</span>,<span class="op">:</span>,<span class="op">:</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">100</span>]), ytrain[<span class="op">:</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">100</span>]));</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Training</span></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1</span></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>  Flux.<span class="fu">train!</span>(loss, parameters, data_loader, optimizer, cb <span class="op">=</span> Flux.<span class="fu">throttle</span>(get_loss, <span class="fl">6000</span>))</span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sum(logitcrossentropy(model(xtrain[:, :, :, 1:100]), ytrain[:, 1:100])) = 2.3061277438671386</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-122_8fa34e2bb6cea93df0b6aa7900bec965">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">softmax</span>(<span class="fu">model</span>(xtrain[<span class="op">:</span>,<span class="op">:</span>,<span class="op">:</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]))[<span class="op">:</span>,<span class="fl">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10-element Vector{Float64}:
 0.09586345767114277
 0.11266421627792989
 0.09877601053217933
 0.09835097514007642
 0.10478797203759319
 0.08793665932702367
 0.1000726133469189
 0.10555513334585118
 0.09519990215783991
 0.10079306016344458</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="recurrent-neural-networks" class="level1">
<h1>Recurrent neural networks</h1>
<p>Recurrent neural networks are also deep neural networks but use layers specialized to handle time-series. In the following, we will use again the ‘keras’ package (Python: ‘keras’ (<span class="citation" data-cites="chollet2015keras">Chollet et al. (<a href="#ref-chollet2015keras" role="doc-biblioref">2015</a>)</span>); Julia: ‘Flux’ (<span class="citation" data-cites="Flux">(<a href="#ref-Flux" role="doc-biblioref"><strong>Flux?</strong></a>)</span>)) but we will not differentiate between classification and regression because the only difference would be to change the last layer and the loss function (see section ‘Deep neural networks’).</p>
<p>About the data, we simulated in the following one time series from a simple ARIMA process, using the ‘arima.sim’ function. Our goal is to train a net which is able to predict the next 10 time points based on the previous 10 time points.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false" href="">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-3" role="tab" aria-controls="tabset-14-3" aria-selected="false" href="">Julia</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-124_bb2f110c74043cbe6ab91e6682e3815f">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="do">## RNNs</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">arima.sim</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="sc">-</span><span class="fl">0.7</span>)) ))</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We use here a simplified way to create X and Y </span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="co"># since the focus is on creating the RNNs</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">matrix</span>(data, <span class="at">ncol =</span> 10L, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">array</span>(data[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">2</span>), ], <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">10</span>, <span class="dv">1</span>))</span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> data[<span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">2</span>), ]</span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>RNN <span class="ot">=</span> </span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keras_model_sequential</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first hidden layer</span></span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_gru</span>(<span class="at">input_shape =</span> <span class="fu">list</span>(10L, 1L),</span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">units =</span> <span class="dv">50</span>, </span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb202-16"><a href="#cb202-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we want to predict the next 10 time steps</span></span>
<span id="cb202-17"><a href="#cb202-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">10</span>)</span>
<span id="cb202-18"><a href="#cb202-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-19"><a href="#cb202-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-20"><a href="#cb202-20" aria-hidden="true" tabindex="-1"></a><span class="co"># add loss function and optimizer</span></span>
<span id="cb202-21"><a href="#cb202-21" aria-hidden="true" tabindex="-1"></a>RNN <span class="sc">%&gt;%</span> </span>
<span id="cb202-22"><a href="#cb202-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compile</span>(<span class="at">loss =</span> loss_mean_squared_error,</span>
<span id="cb202-23"><a href="#cb202-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">optimizer =</span> <span class="fu">optimizer_adamax</span>(<span class="fl">0.01</span>))</span>
<span id="cb202-24"><a href="#cb202-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-25"><a href="#cb202-25" aria-hidden="true" tabindex="-1"></a>RNN <span class="sc">%&gt;%</span> </span>
<span id="cb202-26"><a href="#cb202-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(X, Y, <span class="at">epochs =</span> <span class="dv">5</span>, <span class="at">verbose =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-125_b4a38960d83bd1b2b94f89ad9032faf8">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(RNN, X), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]       [,3]        [,4]        [,5]        [,6]
[1,]  0.1204937 -0.2040338 0.03065974 -0.03734706 -0.03956399 -0.04487735
[2,]  0.3278825  0.5387991 0.24432594 -0.89730626 -0.72631729  0.03031456
[3,] -0.1234365 -0.4640800 0.04383389  0.05409218  0.15537545 -0.26630971
            [,7]      [,8]        [,9]       [,10]
[1,]  0.02848135 0.1321188 -0.05021105 -0.02779741
[2,]  0.62033558 0.2663229 -0.64982963  0.30654693
[3,] -0.11355393 0.1845903  0.17258941  0.05272641</code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-126_f238fcf7b1cc195ed74951740edc5e7a">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> <span class="op">*</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> r.X <span class="co"># get data from R</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> r.Y </span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>RNN <span class="op">=</span> keras.Sequential()</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first hidden layer</span></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>RNN.add(GRU(input_shape <span class="op">=</span> [<span class="dv">10</span>, <span class="dv">1</span>],units <span class="op">=</span> <span class="dv">50</span>, activation <span class="op">=</span> <span class="st">"relu"</span>))</span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a>RNN.add(Dense(units <span class="op">=</span> <span class="dv">10</span>))</span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a>RNN.summary()</span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a><span class="co"># add loss function and optimizer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "sequential_7"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_1 (GRU)                 (None, 50)                7950      
                                                                 
 dense_16 (Dense)            (None, 10)                510       
                                                                 
=================================================================
Total params: 8,460
Trainable params: 8,460
Non-trainable params: 0
_________________________________________________________________</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>RNN.<span class="bu">compile</span>(loss <span class="op">=</span> keras.losses.mean_squared_error,</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>            optimizer <span class="op">=</span> keras.optimizers.Adamax(<span class="fl">0.01</span>))</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a><span class="co"># train model</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>RNN.fit(X, Y, epochs <span class="op">=</span> <span class="dv">5</span>, verbose <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;keras.callbacks.History object at 0x7fd33272a460&gt;</code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-127_71398e6415e3c94656916aa8113bc5f2">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>RNN.predict(X)[<span class="dv">0</span>:<span class="dv">10</span>,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
1/2 [==============&gt;...............] - ETA: 0s
2/2 [==============================] - 0s 2ms/step
array([[ 2.06406415e-03, -7.45279938e-02, -4.71422076e-02,
         5.53186983e-02,  9.75405648e-02, -2.28841692e-01,
        -1.32949963e-01,  5.23110181e-02,  6.25179484e-02,
         8.42968225e-02],
       [ 2.64993727e-01,  8.22057843e-01,  2.50395775e-01,
        -2.34732836e-01, -4.09993887e-01,  2.01478541e-01,
         5.58690071e-01, -8.14535245e-02,  7.06662983e-02,
        -4.30903994e-02],
       [-2.22105116e-01, -1.73771679e-01, -1.50137581e-03,
         1.78029835e-01,  1.51309267e-01, -4.18429524e-01,
        -2.62197614e-01,  1.54157281e-01,  1.97321117e-01,
         1.31530657e-01],
       [ 3.78062800e-02, -1.66708887e-01, -2.15172738e-01,
         2.20443994e-01,  3.08242112e-01, -7.63366342e-01,
        -2.75768250e-01,  3.89741927e-01,  3.69443655e-01,
         1.47794470e-01],
       [ 3.63538206e-01,  1.99391916e-01, -7.88873807e-02,
        -1.15546130e-01,  6.61005266e-04, -5.76332733e-02,
         1.24247648e-01, -4.73793969e-02, -1.75689850e-02,
         8.49446058e-02],
       [-1.85852736e-01, -6.59400523e-02,  5.61844297e-02,
         1.19875468e-01,  6.01864010e-02, -2.52522945e-01,
        -1.71717942e-01,  3.76829803e-02,  1.17735036e-01,
         1.04981273e-01],
       [-1.24484293e-01,  2.10252002e-01,  1.39438152e-01,
         5.07258028e-02, -5.71472570e-02, -2.05610693e-01,
        -4.16793115e-03,  1.90782584e-02,  1.06039263e-01,
         7.14097768e-02],
       [-1.11398079e-01, -1.24736734e-01, -2.48917453e-02,
         1.07850730e-01,  1.31235689e-01, -3.23956609e-01,
        -1.96625099e-01,  1.03338011e-01,  1.45983800e-01,
         1.14337683e-01],
       [-2.72525579e-01, -1.79448873e-01, -2.02750042e-02,
         2.45355159e-01,  1.88299119e-01, -5.66974461e-01,
        -3.12278658e-01,  2.56925881e-01,  2.97857046e-01,
         1.54819056e-01],
       [ 4.45893407e-02, -3.23477462e-02, -8.67648423e-02,
         5.96359894e-02,  1.15210317e-01, -3.18621546e-01,
        -1.22284070e-01,  1.11316532e-01,  1.38408050e-01,
         1.09202713e-01]], dtype=float32)

WARNING:tensorflow:5 out of the last 13 calls to &lt;function Model.make_predict_function.&lt;locals&gt;.predict_function at 0x7fd4080c6310&gt; triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has reduce_retracing=True option that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.</code></pre>
</div>
</div>
</div>
<div id="tabset-14-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-3-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-128_3ef083480aa9760f8862d0b7f73b7d75">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">StatsBase;</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets;</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase;</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames;</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">MLJBase.int;</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux</span>, <span class="bu">Statistics;</span></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux.Losses</span>: mse;</span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ARFIMA;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Data preparation:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-129_6b88ae0b4cb16ef6ec8929a73f5d9a3c">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">transpose</span>(<span class="fu">reshape</span>(<span class="fu">convert</span>(<span class="dt">Vector</span>{<span class="dt">Float32</span>}, <span class="fu">arfima</span>(<span class="fl">1000</span>,<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fu">SVector</span>(<span class="op">-</span><span class="fl">0.7</span>))), <span class="fl">100</span>, <span class="fl">10</span>));</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>xtrain <span class="op">=</span> X[<span class="op">:</span>, <span class="fu">collect</span>(<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">100</span>)];</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>ytrain <span class="op">=</span> X[<span class="op">:</span>, <span class="fu">collect</span>(<span class="fl">2</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">100</span>)];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create model (similar to Keras):</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-130_a36dd84e3c2f2f7fa81a874f542afb41">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">Chain</span>(</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">GRU</span>(<span class="fl">10</span><span class="op">=&gt;</span><span class="fl">50</span>),</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Dense</span>(<span class="fl">50</span>, <span class="fl">10</span>)</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain(
  Recur(
    GRUCell(10 =&gt; 50),                  # 9_200 parameters
  ),
  Dense(50 =&gt; 10),                      # 510 parameters
)         # Total: 6 trainable arrays, 9_710 parameters,
          # plus 1 non-trainable, 50 parameters, summarysize 38.297 KiB.</code></pre>
</div>
</div>
<p>Train/optimize Model:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-131_2c20973167fb2272caf804a4159f29b2">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> Flux.<span class="fu">params</span>(model);</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> <span class="fu">ADAM</span>(<span class="fl">0.01</span>);</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>    Flux.<span class="fu">reset!</span>(model); </span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>    grads <span class="op">=</span> <span class="fu">gradient</span>(parameters) <span class="cf">do</span> </span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>        Pred <span class="op">=</span> [<span class="fu">model</span>( xtrain[<span class="op">:</span>,i]) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>];</span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> <span class="fu">mean</span>([<span class="fu">mse</span>(Pred[i], ytrain[<span class="op">:</span>,i]) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>]);</span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">println</span>(loss);</span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>        loss</span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a>    Flux.<span class="fu">update!</span>(optimizer, parameters, grads);</span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.4705178
0.39653876
0.34906423
0.31922546
0.2996167
0.2838701
0.26881057
0.25390214
0.24013399
0.22860071</code></pre>
</div>
</div>
<p>Predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-132_e2942a0dc0a1d6481fa23c6f6db91e62">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>Pred <span class="op">=</span> [<span class="fu">model</span>( xtrain[<span class="op">:</span>,i]) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>];</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>Pred[<span class="fl">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10-element Vector{Float32}:
 -0.1166819
 -0.4504267
 -0.48387158
 -0.09867049
 -0.43863449
 -0.24030928
  0.034330633
 -0.13218436
  0.42408925
 -0.31596702</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="graph-convolutional-neural-networks" class="level1">
<h1>Graph (convolutional) neural networks</h1>
<p>Graph neural networks (GNN) is a young representative of the deep neural network family but is receiving more and more attention in the last years because of their ability to process non-Euclidean data such as graphs.</p>
<p>Currently there is no R package for GNNs available. However, we can use the ‘reticulate’ package (<span class="citation" data-cites="reticulate">Ushey, Allaire, and Tang (<a href="#ref-reticulate" role="doc-biblioref">2022</a>)</span>) to use the python packages ‘torch’ and ‘torch_geometric’ (<span class="citation" data-cites="NEURIPS2019_9015">Paszke et al. (<a href="#ref-NEURIPS2019_9015" role="doc-biblioref">2019</a>)</span>, 2019; <span class="citation" data-cites="Fey_Lenssen_2019">Fey and Lenssen (<a href="#ref-Fey_Lenssen_2019" role="doc-biblioref">2019</a>)</span>).</p>
<p>The following example was mostly adapted from the ‘Node Classification with Graph Neural Networks’ example from the torch_geometric documentation (<a href="https://pytorch-geometric.readthedocs.io/en/latest/notes/colabs.html" class="uri">https://pytorch-geometric.readthedocs.io/en/latest/notes/colabs.html</a>).</p>
<p>The dataset is also provided by the ‘torch_geometric’ package and consists of molecules presented as graphs and the task is to predict whether HIV virus replication is inhibited by the molecule or not (classification, binary classification).</p>
<p>We have not implemented this example in Julia because there is not yet a well-established library for GNNs.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false" href="">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-134_19f9ceac47f3c1b15569a06b929c0e17">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load python packages torch and torch_geometric via the reticulate R package</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>torch <span class="ot">=</span> <span class="fu">import</span>(<span class="st">"torch"</span>) </span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>torch_geometric <span class="ot">=</span> <span class="fu">import</span>(<span class="st">"torch_geometric"</span>)</span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a><span class="co"># helper functions from the torch_geometric modules</span></span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a>GCNConv <span class="ot">=</span> torch_geometric<span class="sc">$</span>nn<span class="sc">$</span>GCNConv</span>
<span id="cb219-8"><a href="#cb219-8" aria-hidden="true" tabindex="-1"></a>global_mean_pool <span class="ot">=</span> torch_geometric<span class="sc">$</span>nn<span class="sc">$</span>global_mean_pool</span>
<span id="cb219-9"><a href="#cb219-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-10"><a href="#cb219-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-11"><a href="#cb219-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the MUTAG TUDataset</span></span>
<span id="cb219-12"><a href="#cb219-12" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">=</span> torch_geometric<span class="sc">$</span>datasets<span class="sc">$</span><span class="fu">TUDataset</span>(<span class="at">root=</span><span class="st">'data/TUDataset'</span>, </span>
<span id="cb219-13"><a href="#cb219-13" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">name=</span><span class="st">'MUTAG'</span>)</span>
<span id="cb219-14"><a href="#cb219-14" aria-hidden="true" tabindex="-1"></a>dataloader <span class="ot">=</span> torch_geometric<span class="sc">$</span>loader<span class="sc">$</span><span class="fu">DataLoader</span>(dataset, </span>
<span id="cb219-15"><a href="#cb219-15" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">batch_size=</span>64L,</span>
<span id="cb219-16"><a href="#cb219-16" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">shuffle=</span><span class="cn">TRUE</span>)</span>
<span id="cb219-17"><a href="#cb219-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-18"><a href="#cb219-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the model with a python class</span></span>
<span id="cb219-19"><a href="#cb219-19" aria-hidden="true" tabindex="-1"></a><span class="co"># There are two classes in the response variable</span></span>
<span id="cb219-20"><a href="#cb219-20" aria-hidden="true" tabindex="-1"></a>GCN <span class="ot">=</span> <span class="fu">PyClass</span>(</span>
<span id="cb219-21"><a href="#cb219-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GCN"</span>, </span>
<span id="cb219-22"><a href="#cb219-22" aria-hidden="true" tabindex="-1"></a>   <span class="at">inherit =</span> torch<span class="sc">$</span>nn<span class="sc">$</span>Module, </span>
<span id="cb219-23"><a href="#cb219-23" aria-hidden="true" tabindex="-1"></a>   <span class="at">defs =</span> <span class="fu">list</span>(</span>
<span id="cb219-24"><a href="#cb219-24" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">__init__</span><span class="st">`</span> <span class="ot">=</span> <span class="cf">function</span>(self, hidden_channels) {</span>
<span id="cb219-25"><a href="#cb219-25" aria-hidden="true" tabindex="-1"></a>         <span class="fu">super</span>()<span class="sc">$</span><span class="st">`</span><span class="at">__init__</span><span class="st">`</span>()</span>
<span id="cb219-26"><a href="#cb219-26" aria-hidden="true" tabindex="-1"></a>         torch<span class="sc">$</span><span class="fu">manual_seed</span>(42L)</span>
<span id="cb219-27"><a href="#cb219-27" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>conv <span class="ot">=</span> <span class="fu">GCNConv</span>(dataset<span class="sc">$</span>num_node_features, hidden_channels)</span>
<span id="cb219-28"><a href="#cb219-28" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>linear <span class="ot">=</span> torch<span class="sc">$</span>nn<span class="sc">$</span><span class="fu">Linear</span>(hidden_channels, dataset<span class="sc">$</span>num_classes)</span>
<span id="cb219-29"><a href="#cb219-29" aria-hidden="true" tabindex="-1"></a>         <span class="cn">NULL</span></span>
<span id="cb219-30"><a href="#cb219-30" aria-hidden="true" tabindex="-1"></a>       },</span>
<span id="cb219-31"><a href="#cb219-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">forward =</span> <span class="cf">function</span>(self, x, edge_index, batch) {</span>
<span id="cb219-32"><a href="#cb219-32" aria-hidden="true" tabindex="-1"></a>         x <span class="ot">=</span> self<span class="sc">$</span><span class="fu">conv</span>(x, edge_index)</span>
<span id="cb219-33"><a href="#cb219-33" aria-hidden="true" tabindex="-1"></a>         x <span class="ot">=</span> x<span class="sc">$</span><span class="fu">relu</span>()</span>
<span id="cb219-34"><a href="#cb219-34" aria-hidden="true" tabindex="-1"></a>         x <span class="ot">=</span> <span class="fu">global_mean_pool</span>(x, batch)</span>
<span id="cb219-35"><a href="#cb219-35" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb219-36"><a href="#cb219-36" aria-hidden="true" tabindex="-1"></a>         x <span class="ot">=</span> torch<span class="sc">$</span>nn<span class="sc">$</span>functional<span class="sc">$</span><span class="fu">dropout</span>(x, <span class="at">p =</span> <span class="fl">0.5</span>, <span class="at">training=</span>self<span class="sc">$</span>training)</span>
<span id="cb219-37"><a href="#cb219-37" aria-hidden="true" tabindex="-1"></a>         x <span class="ot">=</span> self<span class="sc">$</span><span class="fu">linear</span>(x)</span>
<span id="cb219-38"><a href="#cb219-38" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(x)</span>
<span id="cb219-39"><a href="#cb219-39" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb219-40"><a href="#cb219-40" aria-hidden="true" tabindex="-1"></a>   ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Training loop:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-135_d44b691eeeac9f3a9141acdae62c3a0f">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model object</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">GCN</span>(<span class="at">hidden_channels =</span> 64L)</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get optimizer and loss function</span></span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>optimizer <span class="ot">=</span> torch<span class="sc">$</span>optim<span class="sc">$</span><span class="fu">Adamax</span>(model<span class="sc">$</span><span class="fu">parameters</span>(), <span class="at">lr =</span> <span class="fl">0.01</span>)</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>loss_func <span class="ot">=</span> torch<span class="sc">$</span>nn<span class="sc">$</span><span class="fu">CrossEntropyLoss</span>()</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a><span class="co"># set model into training mode (because of the dropout layer)</span></span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">train</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GCN(
  (conv): GCNConv(7, 64)
  (linear): Linear(in_features=64, out_features=2, bias=True)
)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train model</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(e <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>) {</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  iterator <span class="ot">=</span> reticulate<span class="sc">::</span><span class="fu">as_iterator</span>(dataloader)</span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  coro<span class="sc">::</span><span class="fu">loop</span>(<span class="cf">for</span> (b <span class="cf">in</span> iterator) { </span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>     pred <span class="ot">=</span> <span class="fu">model</span>(b<span class="sc">$</span>x, b<span class="sc">$</span>edge_index, b<span class="sc">$</span>batch)</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>     loss <span class="ot">=</span> <span class="fu">loss_func</span>(pred, b<span class="sc">$</span>y)</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>     loss<span class="sc">$</span><span class="fu">backward</span>()</span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>     optimizer<span class="sc">$</span><span class="fu">step</span>()</span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>     optimizer<span class="sc">$</span><span class="fu">zero_grad</span>()</span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(e <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span><span class="dv">0</span>) <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Epoch: "</span>,e,<span class="st">" Loss: "</span>, <span class="fu">round</span>(loss<span class="sc">$</span><span class="fu">item</span>()[<span class="dv">1</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch: 10 Loss: 0.6151
Epoch: 20 Loss: 0.6163
Epoch: 30 Loss: 0.5745
Epoch: 40 Loss: 0.5362
Epoch: 50 Loss: 0.5829</code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-136_809114a96544efa4d8abcc9eb63d58b5">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> torch_geometric<span class="sc">$</span>loader<span class="sc">$</span><span class="fu">DataLoader</span>(dataset, <span class="at">batch_size=</span>64L,<span class="at">shuffle=</span><span class="cn">FALSE</span>)</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>iterator <span class="ot">=</span> reticulate<span class="sc">::</span><span class="fu">as_iterator</span>(test)</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">eval</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GCN(
  (conv): GCNConv(7, 64)
  (linear): Linear(in_features=64, out_features=2, bias=True)
)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>counter <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>coro<span class="sc">::</span><span class="fu">loop</span>(<span class="cf">for</span> (b <span class="cf">in</span> iterator) {</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>  preds[[counter]] <span class="ot">=</span> <span class="fu">model</span>(b<span class="sc">$</span>x, b<span class="sc">$</span>edge_index, b<span class="sc">$</span>batch)</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>  counter <span class="ot">&lt;&lt;-</span> counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(torch<span class="sc">$</span><span class="fu">concat</span>(preds)<span class="sc">$</span><span class="fu">sigmoid</span>()<span class="sc">$</span>data<span class="sc">$</span><span class="fu">cpu</span>()<span class="sc">$</span><span class="fu">numpy</span>(), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]      [,2]
[1,] 0.3076028 0.6427078
[2,] 0.4121239 0.5515330
[3,] 0.4119514 0.5516798</code></pre>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-137_a467e3b08275e982afd195c277b0bd77">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load python packages torch and torch_geometric via the reticulate R package</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch_geometric</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a><span class="co"># helper functions from the torch_geometric modules</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>GCNConv <span class="op">=</span> torch_geometric.nn.GCNConv</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>global_mean_pool <span class="op">=</span> torch_geometric.nn.global_mean_pool</span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the MUTAG TUDataset</span></span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> torch_geometric.datasets.TUDataset(root<span class="op">=</span><span class="st">'data/TUDataset'</span>, </span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>                                             name<span class="op">=</span><span class="st">'MUTAG'</span>)</span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>dataloader <span class="op">=</span> torch_geometric.loader.DataLoader(dataset, </span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a>                                               batch_size<span class="op">=</span><span class="dv">64</span>,</span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a>                                               shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the model with a python class</span></span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a><span class="co"># There are two classes in the response variable</span></span>
<span id="cb228-19"><a href="#cb228-19" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GCN(torch.nn.Module):</span>
<span id="cb228-20"><a href="#cb228-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, hidden_channels):</span>
<span id="cb228-21"><a href="#cb228-21" aria-hidden="true" tabindex="-1"></a>         <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb228-22"><a href="#cb228-22" aria-hidden="true" tabindex="-1"></a>         torch.manual_seed(<span class="dv">42</span>)</span>
<span id="cb228-23"><a href="#cb228-23" aria-hidden="true" tabindex="-1"></a>         <span class="va">self</span>.conv <span class="op">=</span> GCNConv(dataset.num_node_features, hidden_channels)</span>
<span id="cb228-24"><a href="#cb228-24" aria-hidden="true" tabindex="-1"></a>         <span class="va">self</span>.linear <span class="op">=</span> torch.nn.Linear(hidden_channels, dataset.num_classes)</span>
<span id="cb228-25"><a href="#cb228-25" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb228-26"><a href="#cb228-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x, edge_index, batch):</span>
<span id="cb228-27"><a href="#cb228-27" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.conv(x, edge_index)</span>
<span id="cb228-28"><a href="#cb228-28" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> x.relu()</span>
<span id="cb228-29"><a href="#cb228-29" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> global_mean_pool(x, batch)</span>
<span id="cb228-30"><a href="#cb228-30" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> torch.nn.functional.dropout(x, p <span class="op">=</span> <span class="fl">0.5</span>, training<span class="op">=</span><span class="va">self</span>.training)</span>
<span id="cb228-31"><a href="#cb228-31" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.linear(x)</span>
<span id="cb228-32"><a href="#cb228-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Training loop:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-138_cb9f46230195c3301b675e2574ddc937">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model object</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> GCN(hidden_channels <span class="op">=</span> <span class="dv">64</span>)</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get optimizer and loss function</span></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adamax(model.parameters(), lr <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>loss_func <span class="op">=</span> torch.nn.CrossEntropyLoss()</span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="co"># set model into training mode (because of the dropout layer)</span></span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a><span class="co"># train model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GCN(
  (conv): GCNConv(7, 64)
  (linear): Linear(in_features=64, out_features=2, bias=True)
)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> e <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>):</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> b <span class="kw">in</span> dataloader:</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> model(b.x, b.edge_index, b.batch)</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> loss_func(pred, b.y)</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> e <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Epoch: "</span>, e ,<span class="st">" Loss: "</span>, loss.item(), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch:  0  Loss:  0.6617004871368408 

Epoch:  10  Loss:  0.614981472492218 

Epoch:  20  Loss:  0.6161867380142212 

Epoch:  30  Loss:  0.5802667737007141 

Epoch:  40  Loss:  0.5124867558479309 </code></pre>
</div>
</div>
<p>Make predictions:</p>
<div class="cell" data-hash="Supporting_Information_cache/html/unnamed-chunk-139_184debaafcb0b33f2171c969b99960e0">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> []</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> torch_geometric.loader.DataLoader(dataset, batch_size<span class="op">=</span><span class="dv">64</span>,shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">eval</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GCN(
  (conv): GCNConv(7, 64)
  (linear): Linear(in_features=64, out_features=2, bias=True)
)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>counter <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> b <span class="kw">in</span> test:</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>  preds.append( model(b.x, b.edge_index, b.batch) )</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>torch.concat(preds).sigmoid().data.cpu().numpy()[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.30760282, 0.64270777],
       [0.41212386, 0.551533  ],
       [0.4119514 , 0.5516798 ],
       [0.29887193, 0.650517  ],
       [0.48894534, 0.48584774],
       [0.4310807 , 0.5360305 ],
       [0.31375578, 0.63721913],
       [0.34597102, 0.6093393 ],
       [0.50279325, 0.4740774 ],
       [0.30924183, 0.6412629 ]], dtype=float32)</code></pre>
</div>
</div>
</div>
</div>
</div>
<section id="references" class="level2 unnumbered">


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-abadi2016tensorflow" class="csl-entry" role="doc-biblioentry">
Abadi, Martı́n, Paul Barham, Jianmin Chen, Zhifeng Chen, Andy Davis, Jeffrey Dean, Matthieu Devin, et al. 2016. <span>“Tensorflow: A System for Large-Scale Machine Learning.”</span> In <em>12th <span class="math inline">\(\{\)</span>USENIX<span class="math inline">\(\}\)</span> Symposium on Operating Systems Design and Implementation (<span class="math inline">\(\{\)</span>OSDI<span class="math inline">\(\}\)</span> 16)</em>, 265–83.
</div>
<div id="ref-kerasR" class="csl-entry" role="doc-biblioentry">
Allaire, JJ, and François Chollet. 2022. <em>Keras: R Interface to ’Keras’</em>. <a href="https://CRAN.R-project.org/package=keras">https://CRAN.R-project.org/package=keras</a>.
</div>
<div id="ref-xgboost" class="csl-entry" role="doc-biblioentry">
Chen, Tianqi, Tong He, Michael Benesty, Vadim Khotilovich, Yuan Tang, Hyunsu Cho, Kailong Chen, et al. 2022. <em>Xgboost: Extreme Gradient Boosting</em>. <a href="https://CRAN.R-project.org/package=xgboost">https://CRAN.R-project.org/package=xgboost</a>.
</div>
<div id="ref-chollet2015keras" class="csl-entry" role="doc-biblioentry">
Chollet, Francois et al. 2015. <span>“Keras.”</span> GitHub. 2015. <a href="https://github.com/fchollet/keras">https://github.com/fchollet/keras</a>.
</div>
<div id="ref-feinerer2008" class="csl-entry" role="doc-biblioentry">
Feinerer, Ingo, Kurt Hornik, and David Meyer. 2008. <span>“Text Mining Infrastructure in r.”</span> <em>Journal of Statistical Software</em> 25 (5): 1–54. <a href="https://www.jstatsoft.org/v25/i05/">https://www.jstatsoft.org/v25/i05/</a>.
</div>
<div id="ref-wordcloud2018" class="csl-entry" role="doc-biblioentry">
Fellows, Ian. 2018. <em>Wordcloud: Word Clouds</em>. <a href="https://CRAN.R-project.org/package=wordcloud">https://CRAN.R-project.org/package=wordcloud</a>.
</div>
<div id="ref-Fey_Lenssen_2019" class="csl-entry" role="doc-biblioentry">
Fey, Matthias, and Jan E. Lenssen. 2019. <span>“Fast Graph Representation Learning with <span>PyTorch Geometric</span>.”</span> In <em>ICLR Workshop on Representation Learning on Graphs and Manifolds</em>.
</div>
<div id="ref-jahn_europepmc_2021" class="csl-entry" role="doc-biblioentry">
Jahn, Najko. 2021. <em>Europepmc: <span>R</span> <span>Interface</span> to the <span>Europe</span> <span>PubMed</span> <span>Central</span> <span>RESTful</span> <span>Web</span> <span>Service</span></em>. <a href="https://CRAN.R-project.org/package=europepmc">https://CRAN.R-project.org/package=europepmc</a>.
</div>
<div id="ref-wordcloud_2_2018" class="csl-entry" role="doc-biblioentry">
Lang, Dawei, and Guan-tin Chien. 2018. <em>Wordcloud2: Create Word Cloud by ’Htmlwidget’</em>. <a href="https://CRAN.R-project.org/package=wordcloud2">https://CRAN.R-project.org/package=wordcloud2</a>.
</div>
<div id="ref-lecun2015deep" class="csl-entry" role="doc-biblioentry">
LeCun, Yann, Yoshua Bengio, and Geoffrey Hinton. 2015. <span>“Deep Learning.”</span> <em>Nature</em> 521 (7553): 436–44.
</div>
<div id="ref-lecun_mnist_2010" class="csl-entry" role="doc-biblioentry">
LeCun, Yann, Corinna Cortes, and CJ Burges. 2010. <span>“<span>MNIST</span> Handwritten Digit Database.”</span> <em>ATT Labs [Online]. Available: Http://Yann.lecun.com/Exdb/Mnist</em> 2.
</div>
<div id="ref-e1071" class="csl-entry" role="doc-biblioentry">
Meyer, David, Evgenia Dimitriadou, Kurt Hornik, Andreas Weingessel, and Friedrich Leisch. 2022. <em>E1071: Misc Functions of the Department of Statistics, Probability Theory Group (Formerly: E1071), TU Wien</em>. <a href="https://CRAN.R-project.org/package=e1071">https://CRAN.R-project.org/package=e1071</a>.
</div>
<div id="ref-NEURIPS2019_9015" class="csl-entry" role="doc-biblioentry">
Paszke, Adam, Sam Gross, Francisco Massa, Adam Lerer, James Bradbury, Gregory Chanan, Trevor Killeen, et al. 2019. <span>“PyTorch: An Imperative Style, High-Performance Deep Learning Library.”</span> In <em>Advances in Neural Information Processing Systems 32</em>, 8024–35. Curran Associates, Inc. <a href="http://papers.neurips.cc/paper/9015-pytorch-an-imperative-style-high-performance-deep-learning-library.pdf">http://papers.neurips.cc/paper/9015-pytorch-an-imperative-style-high-performance-deep-learning-library.pdf</a>.
</div>
<div id="ref-kknn" class="csl-entry" role="doc-biblioentry">
Schliep, Klaus, and Klaus Hechenbichler. 2016. <em>Kknn: Weighted k-Nearest Neighbors</em>. <a href="https://CRAN.R-project.org/package=kknn">https://CRAN.R-project.org/package=kknn</a>.
</div>
<div id="ref-glmnet" class="csl-entry" role="doc-biblioentry">
Simon, Noah, Jerome Friedman, Trevor Hastie, and Rob Tibshirani. 2011. <span>“Regularization Paths for Cox’s Proportional Hazards Model via Coordinate Descent.”</span> <em>Journal of Statistical Software</em> 39 (5): 1–13. <a href="https://doi.org/10.18637/jss.v039.i05">https://doi.org/10.18637/jss.v039.i05</a>.
</div>
<div id="ref-reticulate" class="csl-entry" role="doc-biblioentry">
Ushey, Kevin, JJ Allaire, and Yuan Tang. 2022. <em>Reticulate: Interface to ’Python’</em>. <a href="https://CRAN.R-project.org/package=reticulate">https://CRAN.R-project.org/package=reticulate</a>.
</div>
<div id="ref-ranger" class="csl-entry" role="doc-biblioentry">
Wright, Marvin N., and Andreas Ziegler. 2017. <span>“<span class="nocase">ranger</span>: A Fast Implementation of Random Forests for High Dimensional Data in <span>C++</span> and <span>R</span>.”</span> <em>Journal of Statistical Software</em> 77 (1): 1–17. <a href="https://doi.org/10.18637/jss.v077.i01">https://doi.org/10.18637/jss.v077.i01</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>